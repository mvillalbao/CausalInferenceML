
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lab 1 - Julia Code &#8212; Causal Inference and ML Course</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'labs/lab_1/group3_lab1_julia';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2. Multicollinearity, Precision Adjustment, and DAGs for Good and Bad controls" href="../lab_2_md.html" />
    <link rel="prev" title="Lab 1 - R Code" href="group3_lab1_r.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/p4_output_39_0.png" class="logo__image only-light" alt="Causal Inference and ML Course - Home"/>
    <script>document.write(`<img src="../../_static/p4_output_39_0.png" class="logo__image only-dark" alt="Causal Inference and ML Course - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Causal Inference & Machine Learning Course
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Labs</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../lab_1_md.html">1. Intro to Partialling-out and Lasso Cross-validation</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="group3_lab1_python.html">Lab 1 - Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="group3_lab1_r.html">Lab 1 - R Code</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Lab 1 - Julia Code</a></li>


</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../lab_2_md.html">2. Multicollinearity, Precision Adjustment, and DAGs for Good and Bad controls</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../lab_2/group3_lab2_python.html">Lab 2 - Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lab_2/group3_lab2_r.html">Lab 2 - R Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lab_2/group3_lab2_julia.html">Lab 2 - Julia Code</a></li>


</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../lab_3_md.html">3. Neyman Orthogonality, Orthogonal Learning, and Double Lasso</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../lab_3/group3_lab3_python.html">Lab 3 - Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lab_3/group3_lab3_r.html">Lab 3 - R Code</a></li>


<li class="toctree-l2"><a class="reference internal" href="../lab_3/group3_lab3_julia.html">Lab 3 - Julia Code</a></li>


</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../lab_4_md.html">4. Bootstraping and Causal Forest Analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../lab_4/group3_lab4_python.html">Lab 4 - Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lab_4/group3_lab4_r.html">Lab 4 - R Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lab_4/group3_lab4_julia.html">Lab 4 - Julia Code</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../lab_5_md.html">5. Double Machine Learning</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../lab_5/group3_lab5_python.html">Lab 5 - Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lab_5/group3_lab5_r.html">Lab 5 - R Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lab_5/group3_lab5_julia.html">Lab 5 - Julia Code</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reports</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../reports/000199908_r1.html">Report 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reports/000199908_r2.html">Report 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reports/000199908_r3.html">Report 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reports/000199908_r4.html">Report 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reports/000199908_r5.html">Report 5</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Flabs/lab_1/group3_lab1_julia.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/labs/lab_1/group3_lab1_julia.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab 1 - Julia Code</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Lab 1 - Julia Code</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#math-demonstrations"><strong>Math Demonstrations</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prove-the-frisch-waugh-lovell-theorem">1. Prove the Frisch-Waugh-Lovell theorem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#show-that-the-conditional-expectation-function-minimizes-expected-squared-error">2. Show that the Conditional Expectation Function minimizes expected squared error</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#replication-1-code"><strong>Replication 1 - Code</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-analysis">Data Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ols-regression-with-controls">Ols regression with controls</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partialling-out-using-ols">Partialling-Out using ols</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summarize-the-results">Summarize the results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-flexible-model">“Extra” flexible model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-validation-in-lasso-regression-manual-implementation-task"><strong>Cross-Validation in Lasso Regression - Manual Implementation Task</strong></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#replication">Replication</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#women-and-male-graph-quartic">Women and male graph (quartic)</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-1-julia-code">
<h1>Lab 1 - Julia Code<a class="headerlink" href="#lab-1-julia-code" title="Link to this heading">#</a></h1>
<section id="math-demonstrations">
<h2><strong>Math Demonstrations</strong><a class="headerlink" href="#math-demonstrations" title="Link to this heading">#</a></h2>
<section id="prove-the-frisch-waugh-lovell-theorem">
<h3>1. Prove the Frisch-Waugh-Lovell theorem<a class="headerlink" href="#prove-the-frisch-waugh-lovell-theorem" title="Link to this heading">#</a></h3>
<p>Given the model:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
y &amp;= D \beta_1 + W \beta_2 + \mu
\end{align*}
\]</div>
<p>where <span class="math notranslate nohighlight">\(y\)</span> is an <span class="math notranslate nohighlight">\(n \times 1\)</span> vector, <span class="math notranslate nohighlight">\(D\)</span> is an <span class="math notranslate nohighlight">\(n \times k_1\)</span> matrix, <span class="math notranslate nohighlight">\(\beta_1\)</span> is a <span class="math notranslate nohighlight">\(k_1 \times 1\)</span> vector, <span class="math notranslate nohighlight">\(W\)</span> is an <span class="math notranslate nohighlight">\(n \times k_2\)</span> matrix, <span class="math notranslate nohighlight">\(\beta_2\)</span> is a <span class="math notranslate nohighlight">\(k_2 \times 1\)</span> vector, and <span class="math notranslate nohighlight">\(\mu\)</span> is an <span class="math notranslate nohighlight">\(n \times 1\)</span> vector of error terms.</p>
<p>We can construct the following equation:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
\epsilon_y &amp;= \epsilon_D \phi + \xi
\end{align*}
\]</div>
<p>Running <span class="math notranslate nohighlight">\(y\)</span> on <span class="math notranslate nohighlight">\(W\)</span>, we get:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
y &amp;= W\hat{\alpha}_1 + \epsilon_y \iff \epsilon_y = y - W\hat{\alpha}_1
\end{align*}
\]</div>
<p>Similarly, running <span class="math notranslate nohighlight">\(D\)</span> on <span class="math notranslate nohighlight">\(W\)</span> gives us:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
D &amp;= W\hat{\alpha}_2 + \epsilon_D \iff \epsilon_D = D - W\hat{\alpha}_2
\end{align*}
\]</div>
<p>Running <span class="math notranslate nohighlight">\(\epsilon_y\)</span> on <span class="math notranslate nohighlight">\(\epsilon_D\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
y - W \hat{\alpha}_1 &amp;= (D - W \hat{\alpha}_2) \phi + \xi \\
y &amp;= W \hat{\alpha}_1 + (D - W \hat{\alpha}_2) \phi + \xi \\
y &amp;= W \hat{\alpha}_1 + D \phi - W \hat{\alpha}_2 \phi + \xi \\
y &amp;= D \phi + W (\hat{\alpha}_1 - \hat{\alpha}_2 \phi) + \xi
\end{align*}
\end{split}\]</div>
<p>Comparing the original model with this, we can see that:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
    \beta_1 &amp;= \phi \\
    \beta_2 &amp;= \hat{\alpha}_1 - \hat{\alpha}_2 \phi \\
    \mu &amp;= \xi
\end{align*}
\end{split}\]</div>
</section>
<section id="show-that-the-conditional-expectation-function-minimizes-expected-squared-error">
<h3>2. Show that the Conditional Expectation Function minimizes expected squared error<a class="headerlink" href="#show-that-the-conditional-expectation-function-minimizes-expected-squared-error" title="Link to this heading">#</a></h3>
<p>Given the model:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
Y &amp;= m(X) + e
\end{align*}
\]</div>
<p>where <span class="math notranslate nohighlight">\(m(X)\)</span> represents the conditional expectation of <span class="math notranslate nohighlight">\(Y\)</span> on <span class="math notranslate nohighlight">\(X\)</span>. Let’s define an arbitrary model:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
Y &amp;= g(X) + w
\end{align*}
\]</div>
<p>where <span class="math notranslate nohighlight">\(g(X)\)</span> represents any function of <span class="math notranslate nohighlight">\(X\)</span>.</p>
<p>Working with the expected squared error from the arbitrary model:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
E[(Y-g(X))^2] &amp;= E[(Y-m(X) + m(X)-g(X))^2] \\
&amp;= E[(Y-m(X))^2 + 2(Y-m(X))(m(X)-g(X)) + (m(X)-g(X))^2] \\
&amp;= E[e^2] + 2E[(Y-m(X))(m(X)-g(X))] + E[(m(X)-g(X))^2]
\end{align*}
\end{split}\]</div>
<p>Using the law of iterated expectations:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
E[(Y-g(X))^2] &amp;= E[e^2] + 2E[E[(Y-m(X))(m(X)-g(X)) \mid X]] + E[(m(X)-g(X))^2]
\end{align*}
\]</div>
<p>Since <span class="math notranslate nohighlight">\(m(X)\)</span> and <span class="math notranslate nohighlight">\(g(X)\)</span> are functions of <span class="math notranslate nohighlight">\(X\)</span>, the term <span class="math notranslate nohighlight">\((m(X)-g(X))\)</span> can be thought of as constant when conditioning on <span class="math notranslate nohighlight">\(X\)</span>. Thus:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
E[(Y-g(X))^2] &amp;= E[e^2] + 2E[E[Y-m(X) \mid X](m(X)-g(X))] + E[(m(X)-g(X))^2]
\end{align*}
\]</div>
<p>It is important to note that <span class="math notranslate nohighlight">\(E[Y-m(X) \mid X] = 0\)</span> by definition of <span class="math notranslate nohighlight">\(m(X)\)</span>, so we get:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
E[(Y-g(X))^2] &amp;= E[e^2] + E[(m(X)-g(X))^2]
\end{align*}
\]</div>
<p>Because the second term in the equation is always non-negative, it is clear that the function is minimized when <span class="math notranslate nohighlight">\(g(X)\)</span> equals <span class="math notranslate nohighlight">\(m(X)\)</span>. In which case:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
E[(Y-g(X))^2] &amp;= E[e^2]
\end{align*}
\]</div>
</section>
</section>
<section id="replication-1-code">
<h2><strong>Replication 1 - Code</strong><a class="headerlink" href="#replication-1-code" title="Link to this heading">#</a></h2>
<p>In the previous lab, we already analyzed data from the March Supplement of the U.S. Current Population Survey (2015) and answered the question how to use job-relevant characteristics, such as education and experience, to best predict wages. Now, we focus on the following inference question:</p>
<p>What is the difference in predicted wages between men and women with the same job-relevant characteristics?</p>
<p>Thus, we analyze if there is a difference in the payment of men and women (<em>gender wage gap</em>). The gender wage gap may partly reflect <em>discrimination</em> against women in the labor market or may partly reflect a <em>selection effect</em>, namely that women are relatively more likely to take on occupations that pay somewhat less (for example, school teaching).</p>
<p>To investigate the gender wage gap, we consider the following log-linear regression model</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\log(Y) &amp;= \beta'X + \epsilon\\
&amp;= \beta_1 D  + \beta_2' W + \epsilon,
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(D\)</span> is the indicator of being female (<span class="math notranslate nohighlight">\(1\)</span> if female and <span class="math notranslate nohighlight">\(0\)</span> otherwise) and the
<span class="math notranslate nohighlight">\(W\)</span>’s are controls explaining variation in wages. Considering transformed wages by the logarithm, we are analyzing the relative difference in the payment of men and women.</p>
<section id="data-analysis">
<h3>Data Analysis<a class="headerlink" href="#data-analysis" title="Link to this heading">#</a></h3>
<p>We consider the same subsample of the U.S. Current Population Survey (2015) as in the previous lab. Let us load the data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Pkg</span>

<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;DataFrames&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Dates&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Plots&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;CategoricalArrays&quot;</span><span class="p">)</span>

<span class="k">using</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">using</span><span class="w"> </span><span class="n">Dates</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>
<span class="k">using</span><span class="w"> </span><span class="n">Statistics</span><span class="p">,</span><span class="n">RData</span><span class="w">  </span><span class="c">#upload data of R format </span>
<span class="k">using</span><span class="w"> </span><span class="n">CategoricalArrays</span><span class="w"> </span><span class="c"># categorical data </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">    Updating</span> registry at `C:\Users\Matias Villalba\.julia\registries\General.toml`
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">   Resolving</span> package versions...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Matias Villalba\.julia\environments\v1.10\Project.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Matias Villalba\.julia\environments\v1.10\Manifest.toml`
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">   Resolving</span> package versions...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Matias Villalba\.julia\environments\v1.10\Project.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Matias Villalba\.julia\environments\v1.10\Manifest.toml`
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">rdata_read</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load</span><span class="p">(</span><span class="s">&quot;../../../data/wage2015_subsample_inference.RData&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdata_read</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">]</span>
<span class="n">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;Number of Rows : &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;Number of Columns : &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">2</span><span class="p">],)</span><span class="w"> </span><span class="c">#rows and columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of Rows : 5150
Number of Columns : 20
</pre></div>
</div>
</div>
</div>
<p><em><strong>Variable description</strong></em></p>
<ul class="simple">
<li><p>occ : occupational classification</p></li>
<li><p>ind : industry classification</p></li>
<li><p>lwage : log hourly wage</p></li>
<li><p>sex : gender (1 female) (0 male)</p></li>
<li><p>shs : some high school</p></li>
<li><p>hsg : High school graduated</p></li>
<li><p>scl : Some College</p></li>
<li><p>clg: College Graduate</p></li>
<li><p>ad: Advanced Degree</p></li>
<li><p>ne: Northeast</p></li>
<li><p>mw: Midwest</p></li>
<li><p>so: South</p></li>
<li><p>we: West</p></li>
<li><p>exp1: experience</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">describe</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class="data-frame"><p>20 rows × 7 columns</p><table class="data-frame"><thead><tr><th></th><th>variable</th><th>mean</th><th>min</th><th>median</th><th>max</th><th>nmissing</th><th>eltype</th></tr><tr><th></th><th title="Symbol">Symbol</th><th title="Union{Nothing, Float64}">Union…</th><th title="Any">Any</th><th title="Union{Nothing, Float64}">Union…</th><th title="Any">Any</th><th title="Int64">Int64</th><th title="DataType">DataType</th></tr></thead><tbody><tr><th>1</th><td>wage</td><td>23.4104</td><td>3.02198</td><td>19.2308</td><td>528.846</td><td>0</td><td>Float64</td></tr><tr><th>2</th><td>lwage</td><td>2.97079</td><td>1.10591</td><td>2.95651</td><td>6.2707</td><td>0</td><td>Float64</td></tr><tr><th>3</th><td>sex</td><td>0.444466</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>4</th><td>shs</td><td>0.023301</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>5</th><td>hsg</td><td>0.243883</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>6</th><td>scl</td><td>0.278058</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>7</th><td>clg</td><td>0.31767</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>8</th><td>ad</td><td>0.137087</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>9</th><td>mw</td><td>0.259612</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>10</th><td>so</td><td>0.296505</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>11</th><td>we</td><td>0.216117</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>12</th><td>ne</td><td>0.227767</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>13</th><td>exp1</td><td>13.7606</td><td>0.0</td><td>10.0</td><td>47.0</td><td>0</td><td>Float64</td></tr><tr><th>14</th><td>exp2</td><td>3.01893</td><td>0.0</td><td>1.0</td><td>22.09</td><td>0</td><td>Float64</td></tr><tr><th>15</th><td>exp3</td><td>8.23587</td><td>0.0</td><td>1.0</td><td>103.823</td><td>0</td><td>Float64</td></tr><tr><th>16</th><td>exp4</td><td>25.118</td><td>0.0</td><td>1.0</td><td>487.968</td><td>0</td><td>Float64</td></tr><tr><th>17</th><td>occ</td><td></td><td>10</td><td></td><td>1e+05</td><td>0</td><td>CategoricalValue{String, UInt16}</td></tr><tr><th>18</th><td>occ2</td><td></td><td>1</td><td></td><td>22</td><td>0</td><td>CategoricalValue{String, UInt8}</td></tr><tr><th>19</th><td>ind</td><td></td><td>370</td><td></td><td>1e+05</td><td>0</td><td>CategoricalValue{String, UInt8}</td></tr><tr><th>20</th><td>ind2</td><td></td><td>2</td><td></td><td>22</td><td>0</td><td>CategoricalValue{String, UInt8}</td></tr></tbody></table></div></div></div>
</div>
<p>To start our (causal) analysis, we compare the sample means given gender:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;lwage&quot;</span><span class="p">,</span><span class="s">&quot;sex&quot;</span><span class="p">,</span><span class="s">&quot;shs&quot;</span><span class="p">,</span><span class="s">&quot;hsg&quot;</span><span class="p">,</span><span class="s">&quot;scl&quot;</span><span class="p">,</span><span class="s">&quot;clg&quot;</span><span class="p">,</span><span class="s">&quot;ad&quot;</span><span class="p">,</span><span class="s">&quot;ne&quot;</span><span class="p">,</span><span class="s">&quot;mw&quot;</span><span class="p">,</span><span class="s">&quot;so&quot;</span><span class="p">,</span><span class="s">&quot;we&quot;</span><span class="p">,</span><span class="s">&quot;exp1&quot;</span><span class="p">])</span>

<span class="n">data_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="n">Z_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">data_female</span><span class="p">,[</span><span class="s">&quot;lwage&quot;</span><span class="p">,</span><span class="s">&quot;sex&quot;</span><span class="p">,</span><span class="s">&quot;shs&quot;</span><span class="p">,</span><span class="s">&quot;hsg&quot;</span><span class="p">,</span><span class="s">&quot;scl&quot;</span><span class="p">,</span><span class="s">&quot;clg&quot;</span><span class="p">,</span><span class="s">&quot;ad&quot;</span><span class="p">,</span><span class="s">&quot;ne&quot;</span><span class="p">,</span><span class="s">&quot;mw&quot;</span><span class="p">,</span><span class="s">&quot;so&quot;</span><span class="p">,</span><span class="s">&quot;we&quot;</span><span class="p">,</span><span class="s">&quot;exp1&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">)</span>

<span class="n">data_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="n">Z_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">data_male</span><span class="p">,[</span><span class="s">&quot;lwage&quot;</span><span class="p">,</span><span class="s">&quot;sex&quot;</span><span class="p">,</span><span class="s">&quot;shs&quot;</span><span class="p">,</span><span class="s">&quot;hsg&quot;</span><span class="p">,</span><span class="s">&quot;scl&quot;</span><span class="p">,</span><span class="s">&quot;clg&quot;</span><span class="p">,</span><span class="s">&quot;ad&quot;</span><span class="p">,</span><span class="s">&quot;ne&quot;</span><span class="p">,</span><span class="s">&quot;mw&quot;</span><span class="p">,</span><span class="s">&quot;so&quot;</span><span class="p">,</span><span class="s">&quot;we&quot;</span><span class="p">,</span><span class="s">&quot;exp1&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">)</span>

<span class="n">means</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataFrame</span><span class="p">(</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span><span class="w"> </span><span class="n">All</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">describe</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="ss">:mean</span><span class="p">)[</span><span class="o">!</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">Men</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">describe</span><span class="p">(</span><span class="n">Z_male</span><span class="p">,</span><span class="ss">:mean</span><span class="p">)[</span><span class="o">!</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">Female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">describe</span><span class="p">(</span><span class="n">Z_female</span><span class="p">,</span><span class="ss">:mean</span><span class="p">)[</span><span class="o">!</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class="data-frame"><p>12 rows × 4 columns</p><table class="data-frame"><thead><tr><th></th><th>variables</th><th>All</th><th>Men</th><th>Female</th></tr><tr><th></th><th title="String">String</th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Float64">Float64</th></tr></thead><tbody><tr><th>1</th><td>lwage</td><td>2.97079</td><td>2.98783</td><td>2.94948</td></tr><tr><th>2</th><td>sex</td><td>0.444466</td><td>0.0</td><td>1.0</td></tr><tr><th>3</th><td>shs</td><td>0.023301</td><td>0.0318071</td><td>0.0126693</td></tr><tr><th>4</th><td>hsg</td><td>0.243883</td><td>0.294303</td><td>0.180865</td></tr><tr><th>5</th><td>scl</td><td>0.278058</td><td>0.273331</td><td>0.283967</td></tr><tr><th>6</th><td>clg</td><td>0.31767</td><td>0.293953</td><td>0.347313</td></tr><tr><th>7</th><td>ad</td><td>0.137087</td><td>0.106606</td><td>0.175186</td></tr><tr><th>8</th><td>ne</td><td>0.227767</td><td>0.22195</td><td>0.235037</td></tr><tr><th>9</th><td>mw</td><td>0.259612</td><td>0.259</td><td>0.260376</td></tr><tr><th>10</th><td>so</td><td>0.296505</td><td>0.298148</td><td>0.294452</td></tr><tr><th>11</th><td>we</td><td>0.216117</td><td>0.220902</td><td>0.210135</td></tr><tr><th>12</th><td>exp1</td><td>13.7606</td><td>13.784</td><td>13.7313</td></tr></tbody></table></div></div></div>
</div>
<p>In particular, the table above shows that the difference in average logwage between men and women is equal to <span class="math notranslate nohighlight">\(0,038\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">mean</span><span class="p">(</span><span class="n">Z_female</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="ss">:lwage</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">Z_male</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="ss">:lwage</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.03834473367441493
</pre></div>
</div>
</div>
</div>
<p>Thus, the unconditional gender wage gap is about <span class="math notranslate nohighlight">\(3,8\)</span>% for the group of never married workers (women get paid less on average in our sample). We also observe that never married working women are relatively more educated than working men and have lower working experience.</p>
<p>This unconditional (predictive) effect of gender equals the coefficient <span class="math notranslate nohighlight">\(\beta\)</span> in the univariate ols regression of <span class="math notranslate nohighlight">\(Y\)</span> on <span class="math notranslate nohighlight">\(D\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\log(Y) &amp;=\beta D + \epsilon.
\end{align}
\]</div>
<p>We verify this by running an ols regression in Julia.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#install all the package that we can need</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;GLM&quot;</span><span class="p">)</span><span class="w"> </span><span class="c"># package to run models </span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;StatsPlots&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;MLBase&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Tables&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;CovarianceMatrices&quot;</span><span class="p">)</span><span class="w"> </span><span class="c"># robust standar error </span>
<span class="c"># Load the installed packages</span>
<span class="k">using</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">using</span><span class="w"> </span><span class="n">CSV</span>
<span class="k">using</span><span class="w"> </span><span class="n">Tables</span>
<span class="k">using</span><span class="w"> </span><span class="n">GLM</span>
<span class="k">using</span><span class="w"> </span><span class="n">CovarianceMatrices</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">   Resolving</span> package versions...
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Project.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Manifest.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">   Resolving</span> package versions...
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Project.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Manifest.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">   Resolving</span> package versions...
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> MLBase ─ v0.9.2
<span class=" -Color -Color-Bold -Color-Bold-Green">    Updating</span> `C:\Users\Alexander\.julia\environments\v1.7\Project.toml`
  [f0e99cf1] + MLBase v0.9.2
<span class=" -Color -Color-Bold -Color-Bold-Green">    Updating</span> `C:\Users\Alexander\.julia\environments\v1.7\Manifest.toml`
  [f0e99cf1] ↑ MLBase v0.9.0 ⇒ v0.9.2
<span class=" -Color -Color-Bold -Color-Bold-Green">Precompiling</span> project...
<span class=" -Color -Color-Green">  ✓ </span>MLBase
<span class=" -Color -Color-Green">  ✓ </span>Lasso
  2 dependencies successfully precompiled in 4 seconds (323 already precompiled)
<span class=" -Color -Color-Bold -Color-Bold-Green">   Resolving</span> package versions...
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Project.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Manifest.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">   Resolving</span> package versions...
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Project.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Manifest.toml`
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Precompiling CovarianceMatrices [60f91f6f-d783-54cb-84f9-544141854719]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">nocontrol_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="nd">@formula</span><span class="p">(</span><span class="n">lwage</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="n">nocontrol_est</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GLM</span><span class="o">.</span><span class="n">coef</span><span class="p">(</span><span class="n">nocontrol_model</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">nocontrol_se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GLM</span><span class="o">.</span><span class="n">coeftable</span><span class="p">(</span><span class="n">nocontrol_model</span><span class="p">)</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

<span class="n">nocontrol_se1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stderror</span><span class="p">(</span><span class="n">HC1</span><span class="p">(),</span><span class="w"> </span><span class="n">nocontrol_model</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;The estimated gender coefficient is &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nocontrol_est</span><span class="w"> </span><span class="p">,</span><span class="s">&quot; and the corresponding robust standard error is &quot;</span><span class="w"> </span><span class="p">,</span><span class="n">nocontrol_se1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The estimated gender coefficient is -0.03834473367440746 and the corresponding robust standard error is 0.015905023733117172
</pre></div>
</div>
</div>
</div>
<p>Next, we run an ols regression of <span class="math notranslate nohighlight">\(Y\)</span> on <span class="math notranslate nohighlight">\((D,W)\)</span> to control for the effect of covariates summarized in <span class="math notranslate nohighlight">\(W\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\log(Y) &amp;=\beta_1 D  + \beta_2' W + \epsilon.
\end{align}
\]</div>
<p>Here, we are considering the flexible model from the previous lab. Hence, <span class="math notranslate nohighlight">\(W\)</span> controls for experience, education, region, and occupation and industry indicators plus transformations and two-way interactions.</p>
<p>Let us run the ols regression with controls.</p>
</section>
<section id="ols-regression-with-controls">
<h3>Ols regression with controls<a class="headerlink" href="#ols-regression-with-controls" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">flex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@formula</span><span class="p">(</span><span class="n">lwage</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">exp1</span><span class="o">+</span><span class="n">exp2</span><span class="o">+</span><span class="n">exp3</span><span class="o">+</span><span class="n">exp4</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">shs</span><span class="o">+</span><span class="n">hsg</span><span class="o">+</span><span class="n">scl</span><span class="o">+</span><span class="n">clg</span><span class="o">+</span><span class="n">occ2</span><span class="o">+</span><span class="n">ind2</span><span class="o">+</span><span class="n">mw</span><span class="o">+</span><span class="n">so</span><span class="o">+</span><span class="n">we</span><span class="p">))</span>
<span class="n">control_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">flex</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="n">control_est</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GLM</span><span class="o">.</span><span class="n">coef</span><span class="p">(</span><span class="n">control_model</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">control_se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GLM</span><span class="o">.</span><span class="n">coeftable</span><span class="p">(</span><span class="n">control_model</span><span class="p">)</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">control_se1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stderror</span><span class="p">(</span><span class="w"> </span><span class="n">HC0</span><span class="p">(),</span><span class="w"> </span><span class="n">control_model</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.015000474421752112
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">control_model</span><span class="w"> </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}}}}, Matrix{Float64}}

lwage ~ 1 + sex + exp1 + exp2 + exp3 + exp4 + shs + hsg + scl + clg + occ2 + ind2 + mw + so + we + exp1 &amp; shs + exp1 &amp; hsg + exp1 &amp; scl + exp1 &amp; clg + exp1 &amp; occ2 + exp1 &amp; ind2 + exp1 &amp; mw + exp1 &amp; so + exp1 &amp; we + exp2 &amp; shs + exp2 &amp; hsg + exp2 &amp; scl + exp2 &amp; clg + exp2 &amp; occ2 + exp2 &amp; ind2 + exp2 &amp; mw + exp2 &amp; so + exp2 &amp; we + exp3 &amp; shs + exp3 &amp; hsg + exp3 &amp; scl + exp3 &amp; clg + exp3 &amp; occ2 + exp3 &amp; ind2 + exp3 &amp; mw + exp3 &amp; so + exp3 &amp; we + exp4 &amp; shs + exp4 &amp; hsg + exp4 &amp; scl + exp4 &amp; clg + exp4 &amp; occ2 + exp4 &amp; ind2 + exp4 &amp; mw + exp4 &amp; so + exp4 &amp; we

Coefficients:
────────────────────────────────────────────────────────────────────────────────────
                        Coef.  Std. Error      t  Pr(&gt;|t|)    Lower 95%    Upper 95%
────────────────────────────────────────────────────────────────────────────────────
(Intercept)       3.86026       0.428619    9.01    &lt;1e-18    3.01998     4.70055
sex              -0.0695532     0.015218   -4.57    &lt;1e-05   -0.0993874  -0.039719
exp1             -0.0677247     0.151976   -0.45    0.6559   -0.365665    0.230215
exp2              1.63629       1.69093     0.97    0.3332   -1.67868     4.95127
exp3             -0.915474      0.688025   -1.33    0.1834   -2.26431     0.433363
exp4              0.142936      0.0907569   1.57    0.1153   -0.0349885   0.32086
shs              -0.123309      0.906832   -0.14    0.8918   -1.90111     1.65449
hsg              -0.528902      0.197756   -2.67    0.0075   -0.916593   -0.141212
scl              -0.292058      0.126016   -2.32    0.0205   -0.539105   -0.0450112
clg              -0.0411641     0.0703862  -0.58    0.5587   -0.179153    0.0968245
occ2: 2           0.16134       0.129724    1.24    0.2137   -0.0929781   0.415657
occ2: 3           0.210151      0.168677    1.25    0.2129   -0.120532    0.540835
occ2: 4           0.070857      0.183717    0.39    0.6997   -0.28931     0.431024
occ2: 5          -0.396008      0.18854    -2.10    0.0357   -0.76563    -0.026385
occ2: 6          -0.231061      0.186966   -1.24    0.2166   -0.597599    0.135476
occ2: 7           0.314725      0.194152    1.62    0.1051   -0.0658997   0.69535
occ2: 8          -0.187542      0.169299   -1.11    0.2680   -0.519443    0.14436
occ2: 9          -0.339027      0.16723    -2.03    0.0427   -0.666873   -0.0111811
occ2: 10          0.0209545     0.156498    0.13    0.8935   -0.285852    0.327761
occ2: 11         -0.642418      0.30909    -2.08    0.0377   -1.24837    -0.036463
occ2: 12         -0.0674774     0.252049   -0.27    0.7889   -0.561605    0.426651
occ2: 13         -0.232978      0.231538   -1.01    0.3144   -0.686896    0.22094
occ2: 14          0.256201      0.322673    0.79    0.4272   -0.376382    0.888784
occ2: 15         -0.193858      0.259508   -0.75    0.4551   -0.702611    0.314894
occ2: 16         -0.0551256     0.147066   -0.37    0.7078   -0.34344     0.233189
occ2: 17         -0.415609      0.136114   -3.05    0.0023   -0.682454   -0.148764
occ2: 18         -0.482217      1.04435    -0.46    0.6443   -2.52962     1.56518
occ2: 19         -0.257941      0.332522   -0.78    0.4380   -0.909832    0.39395
occ2: 20         -0.30102       0.234102   -1.29    0.1986   -0.759965    0.157925
occ2: 21         -0.427181      0.220649   -1.94    0.0529   -0.859751    0.00538904
occ2: 22         -0.869453      0.297522   -2.92    0.0035   -1.45273    -0.286176
ind2: 3          -1.24737       0.645494   -1.93    0.0534   -2.51282     0.018092
ind2: 4          -0.0948281     0.463602   -0.20    0.8379   -1.0037      0.81404
ind2: 5          -0.529386      0.434599   -1.22    0.2232   -1.38139     0.322623
ind2: 6          -0.622169      0.434723   -1.43    0.1524   -1.47442     0.230082
ind2: 7          -0.50475       0.502477   -1.00    0.3152   -1.48983     0.48033
ind2: 8          -0.729544      0.467401   -1.56    0.1186   -1.64586     0.186771
ind2: 9          -0.802533      0.425246   -1.89    0.0592   -1.63621     0.0311395
ind2: 10         -0.580584      0.480878   -1.21    0.2274   -1.52332     0.362151
ind2: 11         -0.985235      0.448157   -2.20    0.0280   -1.86382    -0.106647
ind2: 12         -0.737578      0.424326   -1.74    0.0822   -1.56945     0.0942913
ind2: 13         -1.01833       0.482654   -2.11    0.0349   -1.96455    -0.0721096
ind2: 14         -0.586017      0.415903   -1.41    0.1589   -1.40137     0.229339
ind2: 15         -0.380136      0.590852   -0.64    0.5200   -1.53847     0.778198
ind2: 16         -0.570391      0.438658   -1.30    0.1936   -1.43036     0.289575
ind2: 17         -0.820184      0.425985   -1.93    0.0542   -1.6553      0.0149362
ind2: 18         -0.76136       0.423829   -1.80    0.0725   -1.59225     0.0695337
ind2: 19         -0.881282      0.456567   -1.93    0.0536   -1.77636     0.0137945
ind2: 20         -0.909902      0.44842    -2.03    0.0425   -1.78901    -0.0307984
ind2: 21         -0.758653      0.44058    -1.72    0.0851   -1.62239     0.105081
ind2: 22         -0.404077      0.432873   -0.93    0.3506   -1.2527      0.444548
mw                0.110683      0.0814463   1.36    0.1742   -0.0489879   0.270355
so                0.0224244     0.0743855   0.30    0.7631   -0.123404    0.168253
we               -0.0215659     0.0841591  -0.26    0.7978   -0.186556    0.143424
exp1 &amp; shs       -0.191998      0.195541   -0.98    0.3262   -0.575346    0.191349
exp1 &amp; hsg       -0.0173433     0.0572279  -0.30    0.7619   -0.129536    0.0948491
exp1 &amp; scl       -0.0664505     0.043373   -1.53    0.1256   -0.151481    0.01858
exp1 &amp; clg       -0.0550346     0.0310279  -1.77    0.0762   -0.115863    0.00579393
exp1 &amp; occ2: 2   -0.0736239     0.0501108  -1.47    0.1418   -0.171863    0.0246157
exp1 &amp; occ2: 3   -0.0714859     0.0637688  -1.12    0.2623   -0.196501    0.0535296
exp1 &amp; occ2: 4   -0.0723997     0.0747715  -0.97    0.3330   -0.218985    0.0741859
exp1 &amp; occ2: 5    0.0946732     0.0794005   1.19    0.2332   -0.0609873   0.250334
exp1 &amp; occ2: 6   -0.0348928     0.0712136  -0.49    0.6242   -0.174503    0.104718
exp1 &amp; occ2: 7   -0.227934      0.078486   -2.90    0.0037   -0.381802   -0.074066
exp1 &amp; occ2: 8   -0.0727459     0.0645883  -1.13    0.2601   -0.199368    0.0538762
exp1 &amp; occ2: 9    0.0274143     0.0669517   0.41    0.6822   -0.103841    0.15867
exp1 &amp; occ2: 10   0.00756285    0.0581715   0.13    0.8966   -0.106479    0.121605
exp1 &amp; occ2: 11   0.101422      0.100509    1.01    0.3130   -0.0956214   0.298466
exp1 &amp; occ2: 12  -0.0862744     0.0874768  -0.99    0.3241   -0.257768    0.0852193
exp1 &amp; occ2: 13   0.00671485    0.0761825   0.09    0.9298   -0.142637    0.156067
exp1 &amp; occ2: 14  -0.136915      0.0974458  -1.41    0.1601   -0.327953    0.0541221
exp1 &amp; occ2: 15  -0.0400425     0.0898931  -0.45    0.6560   -0.216273    0.136188
exp1 &amp; occ2: 16  -0.0539314     0.0520926  -1.04    0.3006   -0.156056    0.0481934
exp1 &amp; occ2: 17   0.0147277     0.0467903   0.31    0.7530   -0.0770023   0.106458
exp1 &amp; occ2: 18   0.10741       0.471844    0.23    0.8199   -0.817616    1.03244
exp1 &amp; occ2: 19   0.0047165     0.106074    0.04    0.9645   -0.203237    0.21267
exp1 &amp; occ2: 20   0.0243156     0.0743274   0.33    0.7436   -0.121399    0.170031
exp1 &amp; occ2: 21   0.0791776     0.0696947   1.14    0.2560   -0.0574551   0.21581
exp1 &amp; occ2: 22   0.109325      0.0880828   1.24    0.2146   -0.063357    0.282006
exp1 &amp; ind2: 3    0.475889      0.222748    2.14    0.0327    0.0392024   0.912576
exp1 &amp; ind2: 4    0.0147304     0.15711     0.09    0.9253   -0.293276    0.322737
exp1 &amp; ind2: 5    0.125699      0.153163    0.82    0.4119   -0.174569    0.425966
exp1 &amp; ind2: 6    0.154027      0.152429    1.01    0.3123   -0.144801    0.452856
exp1 &amp; ind2: 7    0.102925      0.178694    0.58    0.5647   -0.247396    0.453245
exp1 &amp; ind2: 8    0.235767      0.16892     1.40    0.1629   -0.0953924   0.566926
exp1 &amp; ind2: 9    0.135908      0.148949    0.91    0.3616   -0.156098    0.427914
exp1 &amp; ind2: 10   0.151258      0.164434    0.92    0.3577   -0.171107    0.473622
exp1 &amp; ind2: 11   0.317489      0.159002    2.00    0.0459    0.0057729   0.629204
exp1 &amp; ind2: 12   0.259109      0.151059    1.72    0.0864   -0.0370341   0.555252
exp1 &amp; ind2: 13   0.339609      0.166924    2.03    0.0420    0.0123634   0.666855
exp1 &amp; ind2: 14   0.144141      0.147799    0.98    0.3295   -0.145612    0.433894
exp1 &amp; ind2: 15  -0.0568181     0.234985   -0.24    0.8089   -0.517494    0.403858
exp1 &amp; ind2: 16   0.0847295     0.155043    0.55    0.5848   -0.219223    0.388682
exp1 &amp; ind2: 17   0.172887      0.151328    1.14    0.2533   -0.123784    0.469557
exp1 &amp; ind2: 18   0.15654       0.149417    1.05    0.2948   -0.136385    0.449464
exp1 &amp; ind2: 19   0.15161       0.162085    0.94    0.3496   -0.166149    0.46937
exp1 &amp; ind2: 20   0.132663      0.156688    0.85    0.3972   -0.174516    0.439842
exp1 &amp; ind2: 21   0.21909       0.155505    1.41    0.1589   -0.0857694   0.52395
exp1 &amp; ind2: 22   0.114581      0.152343    0.75    0.4520   -0.184079    0.413241
exp1 &amp; mw        -0.0279931     0.0296572  -0.94    0.3453   -0.0861345   0.0301484
exp1 &amp; so        -0.00996775    0.0266868  -0.37    0.7088   -0.0622858   0.0423503
exp1 &amp; we         0.00630768    0.0301417   0.21    0.8342   -0.0527835   0.0653989
exp2 &amp; shs        1.90051       1.45025     1.31    0.1901   -0.94263     4.74364
exp2 &amp; hsg        0.117164      0.550973    0.21    0.8316   -0.962989    1.19732
exp2 &amp; scl        0.621792      0.462999    1.34    0.1793   -0.285892    1.52948
exp2 &amp; clg        0.409675      0.380217    1.08    0.2813   -0.335721    1.15507
exp2 &amp; occ2: 2    0.663217      0.552322    1.20    0.2299   -0.419581    1.74602
exp2 &amp; occ2: 3    0.641546      0.710278    0.90    0.3664   -0.750918    2.03401
exp2 &amp; occ2: 4    0.974842      0.865535    1.13    0.2601   -0.721994    2.67168
exp2 &amp; occ2: 5   -0.977882      0.973799   -1.00    0.3153   -2.88696     0.9312
exp2 &amp; occ2: 6    0.105086      0.800227    0.13    0.8955   -1.46372     1.67389
exp2 &amp; occ2: 7    3.14071       0.938942    3.34    0.0008    1.29996     4.98146
exp2 &amp; occ2: 8    0.671088      0.719208    0.93    0.3508   -0.738881    2.08106
exp2 &amp; occ2: 9    0.0231977     0.762914    0.03    0.9757   -1.47246     1.51885
exp2 &amp; occ2: 10  -0.269229      0.640527   -0.42    0.6743   -1.52495     0.986491
exp2 &amp; occ2: 11  -1.08165       1.00576    -1.08    0.2822   -3.05339     0.890081
exp2 &amp; occ2: 12   0.832374      0.934125    0.89    0.3729   -0.998929    2.66368
exp2 &amp; occ2: 13  -0.220981      0.772846   -0.29    0.7749   -1.73611     1.29414
exp2 &amp; occ2: 14   0.751116      0.927255    0.81    0.4180   -1.06672     2.56895
exp2 &amp; occ2: 15  -0.0326858     0.940912   -0.03    0.9723   -1.87729     1.81192
exp2 &amp; occ2: 16   0.363581      0.550955    0.66    0.5093   -0.716537    1.4437
exp2 &amp; occ2: 17  -0.265929      0.486113   -0.55    0.5844   -1.21893     0.687071
exp2 &amp; occ2: 18  -2.56088       5.17009    -0.50    0.6204  -12.6966      7.57482
exp2 &amp; occ2: 19  -0.129176      1.06169    -0.12    0.9032   -2.21056     1.95221
exp2 &amp; occ2: 20  -0.33233       0.722907   -0.46    0.6457   -1.74955     1.08489
exp2 &amp; occ2: 21  -0.91          0.685411   -1.33    0.1843   -2.25371     0.433714
exp2 &amp; occ2: 22  -0.855054      0.827941   -1.03    0.3018   -2.47819     0.768082
exp2 &amp; ind2: 3   -5.93689       2.40679    -2.47    0.0137  -10.6553     -1.2185
exp2 &amp; ind2: 4   -1.10534       1.7102     -0.65    0.5181   -4.4581      2.24741
exp2 &amp; ind2: 5   -2.01492       1.69192    -1.19    0.2337   -5.33184     1.302
exp2 &amp; ind2: 6   -2.22777       1.68169    -1.32    0.1853   -5.52464     1.06909
exp2 &amp; ind2: 7   -1.46481       2.01379    -0.73    0.4670   -5.41274     2.48312
exp2 &amp; ind2: 8   -2.94799       1.85954    -1.59    0.1130   -6.59353     0.697541
exp2 &amp; ind2: 9   -1.77962       1.64712    -1.08    0.2800   -5.00872     1.44948
exp2 &amp; ind2: 10  -2.19733       1.77386    -1.24    0.2155   -5.6749      1.28024
exp2 &amp; ind2: 11  -3.87768       1.76374    -2.20    0.0280   -7.3354     -0.419966
exp2 &amp; ind2: 12  -3.16904       1.68194    -1.88    0.0596   -6.46639     0.128306
exp2 &amp; ind2: 13  -3.9652        1.81307    -2.19    0.0288   -7.51963    -0.410767
exp2 &amp; ind2: 14  -2.07833       1.64904    -1.26    0.2076   -5.31118     1.15452
exp2 &amp; ind2: 15   0.191169      2.60754     0.07    0.9416   -4.92078     5.30311
exp2 &amp; ind2: 16  -1.32659       1.71856    -0.77    0.4402   -4.69574     2.04257
exp2 &amp; ind2: 17  -2.20029       1.68372    -1.31    0.1913   -5.50113     1.10055
exp2 &amp; ind2: 18  -2.20062       1.65666    -1.33    0.1841   -5.44842     1.04718
exp2 &amp; ind2: 19  -1.93085       1.78767    -1.08    0.2802   -5.43548     1.57377
exp2 &amp; ind2: 20  -1.94673       1.7244     -1.13    0.2590   -5.32732     1.43387
exp2 &amp; ind2: 21  -3.11274       1.72379    -1.81    0.0710   -6.49214     0.266666
exp2 &amp; ind2: 22  -1.85783       1.68495    -1.10    0.2703   -5.1611      1.44543
exp2 &amp; mw         0.200561      0.317291    0.63    0.5273   -0.421472    0.822594
exp2 &amp; so         0.0544354     0.281566    0.19    0.8467   -0.49756     0.606431
exp2 &amp; we         0.00127174    0.320787    0.00    0.9968   -0.627615    0.630159
exp3 &amp; shs       -0.672124      0.442663   -1.52    0.1290   -1.53994     0.195693
exp3 &amp; hsg       -0.0179937     0.208318   -0.09    0.9312   -0.426389    0.390402
exp3 &amp; scl       -0.199788      0.185519   -1.08    0.2816   -0.563488    0.163912
exp3 &amp; clg       -0.102523      0.164365   -0.62    0.5328   -0.424752    0.219706
exp3 &amp; occ2: 2   -0.20394       0.221139   -0.92    0.3565   -0.637471    0.22959
exp3 &amp; occ2: 3   -0.236962      0.287037   -0.83    0.4091   -0.799683    0.325759
exp3 &amp; occ2: 4   -0.436696      0.352017   -1.24    0.2148   -1.12681     0.253415
exp3 &amp; occ2: 5    0.38853       0.411886    0.94    0.3456   -0.418951    1.19601
exp3 &amp; occ2: 6    0.0484737     0.329353    0.15    0.8830   -0.597205    0.694152
exp3 &amp; occ2: 7   -1.39493       0.405011   -3.44    0.0006   -2.18893    -0.600926
exp3 &amp; occ2: 8   -0.20539       0.289573   -0.71    0.4782   -0.773082    0.362302
exp3 &amp; occ2: 9   -0.090966      0.314335   -0.29    0.7723   -0.707203    0.525271
exp3 &amp; occ2: 10   0.185475      0.257556    0.72    0.4715   -0.319451    0.690401
exp3 &amp; occ2: 11   0.393155      0.381776    1.03    0.3032   -0.355296    1.14161
exp3 &amp; occ2: 12  -0.220256      0.366021   -0.60    0.5474   -0.93782     0.497308
exp3 &amp; occ2: 13   0.0950356     0.290437    0.33    0.7435   -0.474351    0.664422
exp3 &amp; occ2: 14  -0.144393      0.334162   -0.43    0.6657   -0.799501    0.510714
exp3 &amp; occ2: 15   0.147708      0.364519    0.41    0.6853   -0.566913    0.862328
exp3 &amp; occ2: 16  -0.0378548     0.215129   -0.18    0.8603   -0.459604    0.383894
exp3 &amp; occ2: 17   0.15105       0.187808    0.80    0.4213   -0.217138    0.519238
exp3 &amp; occ2: 18   1.40844       1.88525     0.75    0.4550   -2.28748     5.10437
exp3 &amp; occ2: 19   0.0923425     0.404231    0.23    0.8193   -0.700131    0.884816
exp3 &amp; occ2: 20   0.180699      0.265208    0.68    0.4957   -0.339227    0.700626
exp3 &amp; occ2: 21   0.377908      0.255303    1.48    0.1389   -0.1226      0.878417
exp3 &amp; occ2: 22   0.285506      0.298421    0.96    0.3388   -0.299532    0.870544
exp3 &amp; ind2: 3    2.66658       0.98075     2.72    0.0066    0.743872    4.58929
exp3 &amp; ind2: 4    0.729843      0.687981    1.06    0.2888   -0.618908    2.07859
exp3 &amp; ind2: 5    0.994225      0.684243    1.45    0.1463   -0.347199    2.33565
exp3 &amp; ind2: 6    1.06414       0.680095    1.56    0.1177   -0.269148    2.39743
exp3 &amp; ind2: 7    0.708909      0.833796    0.85    0.3952   -0.925705    2.34352
exp3 &amp; ind2: 8    1.23409       0.748347    1.65    0.0992   -0.233001    2.70119
exp3 &amp; ind2: 9    0.828731      0.66759     1.24    0.2145   -0.480045    2.13751
exp3 &amp; ind2: 10   1.04482       0.706672    1.48    0.1393   -0.340577    2.43021
exp3 &amp; ind2: 11   1.68776       0.716215    2.36    0.0185    0.283655    3.09186
exp3 &amp; ind2: 12   1.37345       0.683557    2.01    0.0446    0.0333676   2.71352
exp3 &amp; ind2: 13   1.63767       0.72593     2.26    0.0241    0.214519    3.06082
exp3 &amp; ind2: 14   1.01629       0.671452    1.51    0.1302   -0.300056    2.33264
exp3 &amp; ind2: 15   0.187948      1.02997     0.18    0.8552   -1.83125     2.20715
exp3 &amp; ind2: 16   0.688968      0.696803    0.99    0.3228   -0.677078    2.05501
exp3 &amp; ind2: 17   1.00855       0.683699    1.48    0.1402   -0.331803    2.34891
exp3 &amp; ind2: 18   1.06056       0.672523    1.58    0.1149   -0.257887    2.37901
exp3 &amp; ind2: 19   0.895987      0.72256     1.24    0.2150   -0.520555    2.31253
exp3 &amp; ind2: 20   0.976894      0.695582    1.40    0.1603   -0.386758    2.34055
exp3 &amp; ind2: 21   1.44152       0.699648    2.06    0.0394    0.069898    2.81314
exp3 &amp; ind2: 22   0.968788      0.68285     1.42    0.1560   -0.369903    2.30748
exp3 &amp; mw        -0.0625771     0.124129   -0.50    0.6142   -0.305926    0.180772
exp3 &amp; so        -0.0115842     0.108422   -0.11    0.9149   -0.224139    0.200971
exp3 &amp; we        -0.0124875     0.125138   -0.10    0.9205   -0.257813    0.232838
exp4 &amp; shs        0.0777418     0.0475427   1.64    0.1021   -0.0154632   0.170947
exp4 &amp; hsg        0.000491255   0.0265964   0.02    0.9853   -0.0516497   0.0526322
exp4 &amp; scl        0.021076      0.0245289   0.86    0.3903   -0.0270117   0.0691637
exp4 &amp; clg        0.00786949    0.0227528   0.35    0.7295   -0.0367363   0.0524753
exp4 &amp; occ2: 2    0.0176389     0.0289257   0.61    0.5420   -0.0390683   0.0743462
exp4 &amp; occ2: 3    0.0303057     0.0376552   0.80    0.4210   -0.0435153   0.104127
exp4 &amp; occ2: 4    0.0584146     0.0457704   1.28    0.2019   -0.0313159   0.148145
exp4 &amp; occ2: 5   -0.0515181     0.0549489  -0.94    0.3485   -0.159243    0.0562063
exp4 &amp; occ2: 6   -0.0170182     0.0440847  -0.39    0.6995   -0.103444    0.0694076
exp4 &amp; occ2: 7    0.190535      0.0558757   3.41    0.0007    0.0809939   0.300077
exp4 &amp; occ2: 8    0.0196522     0.0379084   0.52    0.6042   -0.0546653   0.0939697
exp4 &amp; occ2: 9    0.0190014     0.0421099   0.45    0.6518   -0.0635528   0.101556
exp4 &amp; occ2: 10  -0.0333347     0.0338825  -0.98    0.3252   -0.0997595   0.0330901
exp4 &amp; occ2: 11  -0.0465914     0.0479018  -0.97    0.3308   -0.1405      0.0473175
exp4 &amp; occ2: 12   0.0110212     0.0470536   0.23    0.8148   -0.0812249   0.103267
exp4 &amp; occ2: 13  -0.0136895     0.0358988  -0.38    0.7030   -0.0840673   0.0566883
exp4 &amp; occ2: 14   0.00555824    0.0400331   0.14    0.8896   -0.0729245   0.084041
exp4 &amp; occ2: 15  -0.0327444     0.0462379  -0.71    0.4789   -0.123391    0.0579026
exp4 &amp; occ2: 16  -0.00897062    0.0275729  -0.33    0.7449   -0.0630259   0.0450847
exp4 &amp; occ2: 17  -0.0256735     0.0239306  -1.07    0.2834   -0.0725881   0.0212412
exp4 &amp; occ2: 18  -0.212137      0.2204     -0.96    0.3358   -0.64422     0.219946
exp4 &amp; occ2: 19  -0.0169398     0.0513428  -0.33    0.7415   -0.117595    0.083715
exp4 &amp; occ2: 20  -0.0296125     0.0323353  -0.92    0.3598   -0.0930042   0.0337791
exp4 &amp; occ2: 21  -0.0524577     0.0317251  -1.65    0.0983   -0.114653    0.00973765
exp4 &amp; occ2: 22  -0.0350646     0.0360687  -0.97    0.3310   -0.105775    0.0356463
exp4 &amp; ind2: 3   -0.385179      0.132907   -2.90    0.0038   -0.645735   -0.124623
exp4 &amp; ind2: 4   -0.120948      0.089958   -1.34    0.1789   -0.297306    0.0554102
exp4 &amp; ind2: 5   -0.144105      0.0897994  -1.60    0.1086   -0.320152    0.0319425
exp4 &amp; ind2: 6   -0.152611      0.0892689  -1.71    0.0874   -0.327618    0.0223961
exp4 &amp; ind2: 7   -0.100199      0.11194    -0.90    0.3708   -0.319652    0.119253
exp4 &amp; ind2: 8   -0.160966      0.097978   -1.64    0.1005   -0.353047    0.0311143
exp4 &amp; ind2: 9   -0.117808      0.0877821  -1.34    0.1796   -0.2899      0.0542842
exp4 &amp; ind2: 10  -0.148284      0.0918416  -1.61    0.1065   -0.328335    0.0317665
exp4 &amp; ind2: 11  -0.232296      0.0944506  -2.46    0.0139   -0.417462   -0.0471307
exp4 &amp; ind2: 12  -0.187291      0.0899985  -2.08    0.0375   -0.363728   -0.0108538
exp4 &amp; ind2: 13  -0.215562      0.0946011  -2.28    0.0227   -0.401022   -0.0301012
exp4 &amp; ind2: 14  -0.148352      0.0884992  -1.68    0.0937   -0.32185     0.0251456
exp4 &amp; ind2: 15  -0.0532195     0.131382   -0.41    0.6854   -0.310786    0.204347
exp4 &amp; ind2: 16  -0.104434      0.0916252  -1.14    0.2544   -0.28406     0.0751928
exp4 &amp; ind2: 17  -0.142735      0.0899315  -1.59    0.1125   -0.319041    0.0335711
exp4 &amp; ind2: 18  -0.154625      0.0885883  -1.75    0.0810   -0.328298    0.019048
exp4 &amp; ind2: 19  -0.126959      0.0948784  -1.34    0.1809   -0.312963    0.059045
exp4 &amp; ind2: 20  -0.146855      0.0911188  -1.61    0.1071   -0.325489    0.0317784
exp4 &amp; ind2: 21  -0.203262      0.0920972  -2.21    0.0274   -0.383814   -0.0227102
exp4 &amp; ind2: 22  -0.148095      0.0897937  -1.65    0.0992   -0.324131    0.0279408
exp4 &amp; mw         0.00624394    0.0158699   0.39    0.6940   -0.0248681   0.037356
exp4 &amp; so         0.000314457   0.0136275   0.02    0.9816   -0.0264016   0.0270305
exp4 &amp; we         0.00176845    0.0159602   0.11    0.9118   -0.0295206   0.0330575
────────────────────────────────────────────────────────────────────────────────────
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Coefficient for OLS with controls &quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">control_est</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;robust standard error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">control_se1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coefficient for OLS with controls -0.06955320329637253robust standard error:0.015000474421752112
</pre></div>
</div>
</div>
</div>
<p>The estimated regression coefficient <span class="math notranslate nohighlight">\(\beta_1\approx-0.0696\)</span> measures how our linear prediction of wage changes if we set the gender variable <span class="math notranslate nohighlight">\(D\)</span> from 0 to 1, holding the controls <span class="math notranslate nohighlight">\(W\)</span> fixed.
We can call this the <em>predictive effect</em> (PE), as it measures the impact of a variable on the prediction we make. Overall, we see that the unconditional wage gap of size <span class="math notranslate nohighlight">\(4\)</span>% for women increases to about <span class="math notranslate nohighlight">\(7\)</span>% after controlling for worker characteristics.</p>
<p>Next, we are using the Frisch-Waugh-Lovell theorem from the lecture partialling-out the linear effect of the controls via ols.</p>
</section>
<section id="partialling-out-using-ols">
<h3>Partialling-Out using ols<a class="headerlink" href="#partialling-out-using-ols" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># models</span>
<span class="c"># model for Y</span>
<span class="n">flex_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@formula</span><span class="p">(</span><span class="n">lwage</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="p">(</span><span class="n">exp1</span><span class="o">+</span><span class="n">exp2</span><span class="o">+</span><span class="n">exp3</span><span class="o">+</span><span class="n">exp4</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">shs</span><span class="o">+</span><span class="n">hsg</span><span class="o">+</span><span class="n">scl</span><span class="o">+</span><span class="n">clg</span><span class="o">+</span><span class="n">occ2</span><span class="o">+</span><span class="n">ind2</span><span class="o">+</span><span class="n">mw</span><span class="o">+</span><span class="n">so</span><span class="o">+</span><span class="n">we</span><span class="p">))</span>
<span class="n">flex_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@formula</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="p">(</span><span class="n">exp1</span><span class="o">+</span><span class="n">exp2</span><span class="o">+</span><span class="n">exp3</span><span class="o">+</span><span class="n">exp4</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">shs</span><span class="o">+</span><span class="n">hsg</span><span class="o">+</span><span class="n">scl</span><span class="o">+</span><span class="n">clg</span><span class="o">+</span><span class="n">occ2</span><span class="o">+</span><span class="n">ind2</span><span class="o">+</span><span class="n">mw</span><span class="o">+</span><span class="n">so</span><span class="o">+</span><span class="n">we</span><span class="p">))</span>

<span class="c"># partialling-out the linear effect of W from Y</span>
<span class="n">t_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">residuals</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">flex_y</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">))</span>

<span class="c"># partialling-out the linear effect of W from D</span>
<span class="n">t_D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">residuals</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">flex_d</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">))</span>

<span class="n">data_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataFrame</span><span class="p">(</span><span class="n">t_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_Y</span><span class="p">,</span><span class="w"> </span><span class="n">t_D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_D</span><span class="w"> </span><span class="p">)</span>
<span class="c"># regression of Y on D after partialling-out the effect of W</span>

<span class="n">partial_fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="nd">@formula</span><span class="p">(</span><span class="n">t_Y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">t_D</span><span class="p">),</span><span class="w"> </span><span class="n">data_res</span><span class="p">)</span>

<span class="n">partial_est</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GLM</span><span class="o">.</span><span class="n">coef</span><span class="p">(</span><span class="n">partial_fit</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

<span class="c"># standard error</span>
<span class="n">partial_se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GLM</span><span class="o">.</span><span class="n">coeftable</span><span class="p">(</span><span class="n">partial_fit</span><span class="p">)</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

<span class="n">partial_se1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stderror</span><span class="p">(</span><span class="w"> </span><span class="n">HC0</span><span class="p">(),</span><span class="w"> </span><span class="n">partial_fit</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

<span class="c">#condifence interval</span>
<span class="n">GLM</span><span class="o">.</span><span class="n">confint</span><span class="p">(</span><span class="n">partial_fit</span><span class="p">)[</span><span class="mi">2</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2-element Vector{Float64}:
 -0.09867142357486275
 -0.04043498301882939
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Coefficient for D via partiallig-out &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">partial_est</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; robust standard error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">control_se1</span><span class="w"> </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coefficient for D via partiallig-out -0.06955320329684607 robust standard error:0.015000474421752112
</pre></div>
</div>
</div>
</div>
<p>Again, the estimated coefficient measures the linear predictive effect (PE) of <span class="math notranslate nohighlight">\(D\)</span> on <span class="math notranslate nohighlight">\(Y\)</span> after taking out the linear effect of <span class="math notranslate nohighlight">\(W\)</span> on both of these variables. This coefficient equals the estimated coefficient from the ols regression with controls.</p>
<p>We know that the partialling-out approach works well when the dimension of <span class="math notranslate nohighlight">\(W\)</span> is low
in relation to the sample size <span class="math notranslate nohighlight">\(n\)</span>. When the dimension of <span class="math notranslate nohighlight">\(W\)</span> is relatively high, we need to use variable selection
or penalization for regularization purposes.</p>
<p>In the following, we illustrate the partialling-out approach using lasso instead of ols.</p>
</section>
<section id="summarize-the-results">
<h3>Summarize the results<a class="headerlink" href="#summarize-the-results" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">DataFrame</span><span class="p">(</span><span class="n">modelos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;Without controls&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;full reg&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;partial reg&quot;</span><span class="w"> </span><span class="p">],</span><span class="w"> </span>
<span class="n">Estimate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">nocontrol_est</span><span class="p">,</span><span class="n">control_est</span><span class="p">,</span><span class="w"> </span><span class="n">partial_est</span><span class="p">],</span><span class="w"> </span>
<span class="n">StdError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">nocontrol_se1</span><span class="p">,</span><span class="n">control_se1</span><span class="p">,</span><span class="w"> </span><span class="n">partial_se1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class="data-frame"><p>3 rows × 3 columns</p><table class="data-frame"><thead><tr><th></th><th>modelos</th><th>Estimate</th><th>StdError</th></tr><tr><th></th><th title="String">String</th><th title="Float64">Float64</th><th title="Float64">Float64</th></tr></thead><tbody><tr><th>1</th><td>Without controls</td><td>-0.0383447</td><td>0.015905</td></tr><tr><th>2</th><td>full reg</td><td>-0.0695532</td><td>0.0150005</td></tr><tr><th>3</th><td>partial reg</td><td>-0.0695532</td><td>0.0150005</td></tr></tbody></table></div></div></div>
</div>
<p>It it worth to notice that controlling for worker characteristics increases the gender wage gap from less that 4% to 7%. The controls we used in our analysis include 5 educational attainment indicators (less than high school graduates, high school graduates, some college, college graduate, and advanced degree), 4 region indicators (midwest, south, west, and northeast);  a quartic term (first, second, third, and fourth power) in experience and 22 occupation and 23 industry indicators.</p>
<p>Keep in mind that the predictive effect (PE) does not only measures discrimination (causal effect of being female), it also may reflect
selection effects of unobserved differences in covariates between men and women in our sample.</p>
<p>Next we try “extra” flexible model, where we take interactions of all controls, giving us about 1000 controls.</p>
</section>
<section id="extra-flexible-model">
<h3>“Extra” flexible model<a class="headerlink" href="#extra-flexible-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;StatsModels&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Combinatorics&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;IterTools&quot;</span><span class="p">)</span>
<span class="c"># we have to configure the package internaly with the itertools package, this because </span>
<span class="c">#julia dont iunderstand (a formula) ^2, it takes as an entire term not as interactions </span>
<span class="c">#between variables</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">   Resolving</span> package versions...
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Project.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Manifest.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">   Resolving</span> package versions...
<span class=" -Color -Color-Bold -Color-Bold-Green">    Updating</span> `C:\Users\Alexander\.julia\environments\v1.7\Project.toml`
  [861a8166] + Combinatorics v1.0.2
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Manifest.toml`
<span class=" -Color -Color-Bold -Color-Bold-Green">   Resolving</span> package versions...
<span class=" -Color -Color-Bold -Color-Bold-Green">    Updating</span> `C:\Users\Alexander\.julia\environments\v1.7\Project.toml`
  [c8e1da08] + IterTools v1.4.0
<span class=" -Color -Color-Bold -Color-Bold-Green">  No Changes</span> to `C:\Users\Alexander\.julia\environments\v1.7\Manifest.toml`
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#this code fix the problem mencioned above</span>
<span class="k">using</span><span class="w"> </span><span class="n">StatsModels</span><span class="p">,</span><span class="w"> </span><span class="n">Combinatorics</span><span class="p">,</span><span class="w"> </span><span class="n">IterTools</span>

<span class="n">combinations_upto</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Iterators</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">)</span>
<span class="n">expand_exp</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">deg</span><span class="o">::</span><span class="kt">ConstantTerm</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">tuple</span><span class="p">(((</span><span class="o">&amp;</span><span class="p">)(</span><span class="n">terms</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">terms</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">combinations_upto</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">deg</span><span class="o">.</span><span class="n">n</span><span class="p">))</span><span class="o">...</span><span class="p">)</span>

<span class="n">StatsModels</span><span class="o">.</span><span class="n">apply_schema</span><span class="p">(</span><span class="n">t</span><span class="o">::</span><span class="kt">FunctionTerm</span><span class="p">{</span><span class="kt">typeof</span><span class="p">(</span><span class="o">^</span><span class="p">)},</span><span class="w"> </span><span class="n">sch</span><span class="o">::</span><span class="kt">StatsModels</span><span class="o">.</span><span class="n">Schema</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="o">::</span><span class="kt">Type</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">apply_schema</span><span class="o">.</span><span class="p">(</span><span class="n">expand_exp</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">args_parsed</span><span class="o">...</span><span class="p">),</span><span class="w"> </span><span class="kt">Ref</span><span class="p">(</span><span class="n">sch</span><span class="p">),</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span>

<span class="n">StatsModels</span><span class="o">.</span><span class="n">apply_schema</span><span class="p">(</span><span class="n">t</span><span class="o">::</span><span class="kt">FunctionTerm</span><span class="p">{</span><span class="kt">typeof</span><span class="p">(</span><span class="o">^</span><span class="p">)},</span><span class="w"> </span><span class="n">sch</span><span class="o">::</span><span class="kt">StatsModels</span><span class="o">.</span><span class="n">FullRank</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="o">::</span><span class="kt">Type</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">apply_schema</span><span class="o">.</span><span class="p">(</span><span class="n">expand_exp</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">args_parsed</span><span class="o">...</span><span class="p">),</span><span class="w"> </span><span class="kt">Ref</span><span class="p">(</span><span class="n">sch</span><span class="p">),</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">extra_flex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@formula</span><span class="p">(</span><span class="n">lwage</span><span class="w"> </span><span class="o">~</span><span class="w">  </span><span class="n">sex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">exp1</span><span class="o">+</span><span class="n">exp2</span><span class="o">+</span><span class="n">exp3</span><span class="o">+</span><span class="n">exp4</span><span class="o">+</span><span class="n">shs</span><span class="o">+</span><span class="n">hsg</span><span class="o">+</span><span class="n">scl</span><span class="o">+</span><span class="n">clg</span><span class="o">+</span><span class="n">occ2</span><span class="o">+</span><span class="n">ind2</span><span class="o">+</span><span class="n">mw</span><span class="o">+</span><span class="n">so</span><span class="o">+</span><span class="n">we</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>

<span class="n">control_fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">extra_flex</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="n">control_est</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GLM</span><span class="o">.</span><span class="n">coef</span><span class="p">(</span><span class="n">control_fit</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;Number of Extra-Flex Controls: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">modelmatrix</span><span class="p">(</span><span class="n">control_fit</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c">#minus the intercept</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;Coefficient for OLS with extra flex controls &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">control_est</span><span class="p">)</span>

<span class="c">#std error</span>
<span class="n">control_se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GLM</span><span class="o">.</span><span class="n">stderror</span><span class="p">(</span><span class="n">control_fit</span><span class="p">)[</span><span class="mi">2</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of Extra-Flex Controls: 979
Coefficient for OLS with extra flex controls -0.061270463792332606
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="cross-validation-in-lasso-regression-manual-implementation-task">
<h2><strong>Cross-Validation in Lasso Regression - Manual Implementation Task</strong><a class="headerlink" href="#cross-validation-in-lasso-regression-manual-implementation-task" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># import Pkg; Pkg.add(&quot;ScikitLearn&quot;)</span>
<span class="c"># import Pkg; Pkg.add(&quot;StatsBase&quot;)</span>
<span class="c"># import Pkg; Pkg.add(&quot;CSVFiles&quot;)</span>
<span class="c"># import Pkg; Pkg.add(&quot;RDatasets&quot;)</span>
<span class="c"># import Pkg; Pkg.add(&quot;MLJ&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">following</span> <span class="n">package</span> <span class="n">names</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">resolved</span><span class="p">:</span>
 <span class="o">*</span> <span class="n">StandardScaler</span> <span class="p">(</span><span class="ow">not</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">project</span><span class="p">,</span> <span class="n">manifest</span> <span class="ow">or</span> <span class="n">registry</span><span class="p">)</span>
   <span class="n">Suggestions</span><span class="p">:</span> <span class="n">StandardizedRestrictedBoltzmannMachines</span>

<span class="ne">Stacktrace</span>:
 <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">pkgerror</span><span class="p">(</span><span class="n">msg</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
   <span class="o">@</span> <span class="n">Pkg</span><span class="o">.</span><span class="n">Types</span> <span class="o">/</span><span class="n">Applications</span><span class="o">/</span><span class="n">Julia</span><span class="o">-</span><span class="mf">1.10</span><span class="o">.</span><span class="n">app</span><span class="o">/</span><span class="n">Contents</span><span class="o">/</span><span class="n">Resources</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.10</span><span class="o">/</span><span class="n">Pkg</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">Types</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">70</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">ensure_resolved</span><span class="p">(</span><span class="n">ctx</span><span class="p">::</span><span class="n">Pkg</span><span class="o">.</span><span class="n">Types</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">manifest</span><span class="p">::</span><span class="n">Pkg</span><span class="o">.</span><span class="n">Types</span><span class="o">.</span><span class="n">Manifest</span><span class="p">,</span> <span class="n">pkgs</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Pkg</span><span class="o">.</span><span class="n">Types</span><span class="o">.</span><span class="n">PackageSpec</span><span class="p">};</span> <span class="n">registry</span><span class="p">::</span><span class="n">Bool</span><span class="p">)</span>
   <span class="o">@</span> <span class="n">Pkg</span><span class="o">.</span><span class="n">Types</span> <span class="o">/</span><span class="n">Applications</span><span class="o">/</span><span class="n">Julia</span><span class="o">-</span><span class="mf">1.10</span><span class="o">.</span><span class="n">app</span><span class="o">/</span><span class="n">Contents</span><span class="o">/</span><span class="n">Resources</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.10</span><span class="o">/</span><span class="n">Pkg</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">Types</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1030</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">ensure_resolved</span>
   <span class="o">@</span> <span class="o">/</span><span class="n">Applications</span><span class="o">/</span><span class="n">Julia</span><span class="o">-</span><span class="mf">1.10</span><span class="o">.</span><span class="n">app</span><span class="o">/</span><span class="n">Contents</span><span class="o">/</span><span class="n">Resources</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.10</span><span class="o">/</span><span class="n">Pkg</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">Types</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">981</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">add</span><span class="p">(</span><span class="n">ctx</span><span class="p">::</span><span class="n">Pkg</span><span class="o">.</span><span class="n">Types</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">pkgs</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Pkg</span><span class="o">.</span><span class="n">Types</span><span class="o">.</span><span class="n">PackageSpec</span><span class="p">};</span> <span class="n">preserve</span><span class="p">::</span><span class="n">Pkg</span><span class="o">.</span><span class="n">Types</span><span class="o">.</span><span class="n">PreserveLevel</span><span class="p">,</span> <span class="n">platform</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">BinaryPlatforms</span><span class="o">.</span><span class="n">Platform</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">::</span><span class="nd">@Kwargs</span><span class="p">{</span><span class="n">io</span><span class="p">::</span><span class="n">IJulia</span><span class="o">.</span><span class="n">IJuliaStdio</span><span class="p">{</span><span class="n">Base</span><span class="o">.</span><span class="n">PipeEndpoint</span><span class="p">}})</span>
   <span class="o">@</span> <span class="n">Pkg</span><span class="o">.</span><span class="n">API</span> <span class="o">/</span><span class="n">Applications</span><span class="o">/</span><span class="n">Julia</span><span class="o">-</span><span class="mf">1.10</span><span class="o">.</span><span class="n">app</span><span class="o">/</span><span class="n">Contents</span><span class="o">/</span><span class="n">Resources</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.10</span><span class="o">/</span><span class="n">Pkg</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">API</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">267</span>
 <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">add</span><span class="p">(</span><span class="n">pkgs</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Pkg</span><span class="o">.</span><span class="n">Types</span><span class="o">.</span><span class="n">PackageSpec</span><span class="p">};</span> <span class="n">io</span><span class="p">::</span><span class="n">IJulia</span><span class="o">.</span><span class="n">IJuliaStdio</span><span class="p">{</span><span class="n">Base</span><span class="o">.</span><span class="n">PipeEndpoint</span><span class="p">},</span> <span class="n">kwargs</span><span class="p">::</span><span class="nd">@Kwargs</span><span class="p">{})</span>
   <span class="o">@</span> <span class="n">Pkg</span><span class="o">.</span><span class="n">API</span> <span class="o">/</span><span class="n">Applications</span><span class="o">/</span><span class="n">Julia</span><span class="o">-</span><span class="mf">1.10</span><span class="o">.</span><span class="n">app</span><span class="o">/</span><span class="n">Contents</span><span class="o">/</span><span class="n">Resources</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.10</span><span class="o">/</span><span class="n">Pkg</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">API</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">159</span>
 <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">add</span><span class="p">(</span><span class="n">pkgs</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Pkg</span><span class="o">.</span><span class="n">Types</span><span class="o">.</span><span class="n">PackageSpec</span><span class="p">})</span>
   <span class="o">@</span> <span class="n">Pkg</span><span class="o">.</span><span class="n">API</span> <span class="o">/</span><span class="n">Applications</span><span class="o">/</span><span class="n">Julia</span><span class="o">-</span><span class="mf">1.10</span><span class="o">.</span><span class="n">app</span><span class="o">/</span><span class="n">Contents</span><span class="o">/</span><span class="n">Resources</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.10</span><span class="o">/</span><span class="n">Pkg</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">API</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">148</span>
 <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="n">add</span>
   <span class="o">@</span> <span class="o">/</span><span class="n">Applications</span><span class="o">/</span><span class="n">Julia</span><span class="o">-</span><span class="mf">1.10</span><span class="o">.</span><span class="n">app</span><span class="o">/</span><span class="n">Contents</span><span class="o">/</span><span class="n">Resources</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.10</span><span class="o">/</span><span class="n">Pkg</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">API</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">147</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">add</span><span class="p">(</span><span class="n">pkg</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
   <span class="o">@</span> <span class="n">Pkg</span><span class="o">.</span><span class="n">API</span> <span class="o">/</span><span class="n">Applications</span><span class="o">/</span><span class="n">Julia</span><span class="o">-</span><span class="mf">1.10</span><span class="o">.</span><span class="n">app</span><span class="o">/</span><span class="n">Contents</span><span class="o">/</span><span class="n">Resources</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.10</span><span class="o">/</span><span class="n">Pkg</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">API</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">146</span>
 <span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
   <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">94</span><span class="p">]:</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Transformers&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">   Resolving</span> package versions...
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> ShowCases ──────────── v0.1.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> ContextVariablesX ──── v0.1.3
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Accessors ──────────── v0.1.36
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> ZipFile ────────────── v0.9.4
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> HTML_Entities ──────── v1.0.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> TimerOutputs ───────── v0.5.23
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> NNlibCUDA ──────────── v0.2.6
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> NNlib ──────────────── v0.8.21
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Pidfile ────────────── v1.3.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Optimisers ─────────── v0.2.15
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> FuncPipelines ──────── v0.2.3
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> InitialValues ──────── v0.3.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> CEnum ──────────────── v0.4.2
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> FunctionWrappers ───── v1.1.3
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> BFloat16s ──────────── v0.2.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> GPUArrays ──────────── v8.8.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> ZygoteRules ────────── v0.2.5
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> PrettyPrint ────────── v0.2.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> HuggingFaceApi ─────── v0.1.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Static ─────────────── v0.7.8
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> RandomNumbers ──────── v1.5.3
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Tricks ─────────────── v0.1.8
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> RealDot ────────────── v0.1.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> TupleTools ─────────── v1.5.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Fetch ──────────────── v0.1.3
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> IRTools ────────────── v0.4.12
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> LLVM ───────────────── v4.17.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> FLoopsBase ─────────── v0.1.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Functors ───────────── v0.3.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> ProgressLogging ────── v0.1.4
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> IfElse ─────────────── v0.1.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> MicroCollections ───── v0.1.4
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Zygote ─────────────── v0.6.69
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> DoubleArrayTries ───── v0.0.3
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> StringEncodings ────── v0.3.7
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> DefineSingletons ───── v0.1.2
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> OneHotArrays ───────── v0.2.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> NameResolution ─────── v0.1.5
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> MLUtils ────────────── v0.3.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> UnsafeAtomicsLLVM ──── v0.1.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Random123 ──────────── v1.7.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> StringViews ────────── v1.3.3
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> ValSplit ───────────── v0.1.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> BinaryProvider ─────── v0.5.10
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> ChainRules ─────────── v1.63.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> CommonSubexpressions ─ v0.3.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> BytePairEncoding ───── v0.3.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> MLStyle ────────────── v0.4.17
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> BangBang ───────────── v0.3.37
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> FLoops ─────────────── v0.2.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> ArgCheck ───────────── v2.3.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> DiffRules ──────────── v1.15.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> PrimitiveOneHot ────── v0.1.4
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> JSON3 ──────────────── v1.14.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> DataDeps ───────────── v0.7.8
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> DiffResults ────────── v1.1.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Flux ───────────────── v0.13.13
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> NeuralAttentionlib ─── v0.1.5
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> OhMyArtifacts ──────── v0.3.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> LLVMExtra_jll ──────── v0.0.18+0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> CompositionsBase ───── v0.1.2
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> KernelAbstractions ─── v0.9.18
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Strided ────────────── v1.2.3
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> StrTables ──────────── v1.0.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> AbstractTrees ──────── v0.4.5
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> PartialFunctions ───── v1.2.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> UnsafeAtomics ──────── v0.2.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> JuliaVariables ─────── v0.2.4
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> SparseInverseSubset ── v0.1.2
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> SimpleTraits ───────── v0.9.4
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> GPUArraysCore ──────── v0.1.5
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Adapt ──────────────── v3.7.2
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Atomix ─────────────── v0.1.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> StructWalk ─────────── v0.2.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> InternedStrings ────── v0.7.0
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Transducers ────────── v0.4.80
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Baselet ────────────── v0.1.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> GPUCompiler ────────── v0.17.3
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> FoldsThreads ───────── v0.1.2
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> StructArrays ───────── v0.6.18
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> ForwardDiff ────────── v0.10.36
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> SplittablesBase ────── v0.1.15
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> LightXML ───────────── v0.9.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> WordTokenizers ─────── v0.5.6
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Pickle ─────────────── v0.3.2
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> CUDA ───────────────── v3.13.1
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> TextEncodeBase ─────── v0.5.12
<span class=" -Color -Color-Bold -Color-Bold-Green">   Installed</span> Transformers ───────── v0.1.25
<span class=" -Color -Color-Bold -Color-Bold-Green">    Updating</span> `~/.julia/environments/v1.10/Project.toml`
<span class=" -Color -Color-Green">⌃</span> [21ca0261] + Transformers v0.1.25
<span class=" -Color -Color-Bold -Color-Bold-Green">    Updating</span> `~/.julia/environments/v1.10/Manifest.toml`
  [1520ce14] + AbstractTrees v0.4.5
  [7d9f7c33] + Accessors v0.1.36
<span class=" -Color -Color-Yellow">⌅</span> [79e6a3ab] ↓ Adapt v4.0.4 ⇒ v3.7.2
  [dce04be8] + ArgCheck v2.3.0
  [a9b6321e] + Atomix v0.1.0
<span class=" -Color -Color-Yellow">⌅</span> [ab4f0b2a] + BFloat16s v0.2.0
<span class=" -Color -Color-Yellow">⌅</span> [198e06fe] + BangBang v0.3.37
  [9718e550] + Baselet v0.1.1
  [b99e7846] + BinaryProvider v0.5.10
<span class=" -Color -Color-Yellow">⌅</span> [a4280ba5] + BytePairEncoding v0.3.1
<span class=" -Color -Color-Yellow">⌅</span> [fa961155] + CEnum v0.4.2
<span class=" -Color -Color-Yellow">⌅</span> [052768ef] + CUDA v3.13.1
  [082447d4] + ChainRules v1.63.0
  [bbf7d656] + CommonSubexpressions v0.3.0
  [a33af91c] + CompositionsBase v0.1.2
  [6add18c4] + ContextVariablesX v0.1.3
<span class=" -Color -Color-Green">⌃</span> [124859b0] + DataDeps v0.7.8
  [244e2a9f] + DefineSingletons v0.1.2
  [163ba53b] + DiffResults v1.1.0
  [b552c78f] + DiffRules v1.15.1
<span class=" -Color -Color-Yellow">⌅</span> [abbaa0e5] + DoubleArrayTries v0.0.3
  [cc61a311] + FLoops v0.2.1
  [b9860ae5] + FLoopsBase v0.1.1
<span class=" -Color -Color-Green">⌃</span> [bb354801] + Fetch v0.1.3
<span class=" -Color -Color-Yellow">⌅</span> [587475ba] + Flux v0.13.13
  [9c68100b] + FoldsThreads v0.1.2
  [f6369f11] + ForwardDiff v0.10.36
  [9ed96fbb] + FuncPipelines v0.2.3
  [069b7b12] + FunctionWrappers v1.1.3
<span class=" -Color -Color-Yellow">⌅</span> [d9f16b24] + Functors v0.3.0
<span class=" -Color -Color-Yellow">⌅</span> [0c68f7d7] + GPUArrays v8.8.1
<span class=" -Color -Color-Yellow">⌅</span> [46192b85] + GPUArraysCore v0.1.5
<span class=" -Color -Color-Yellow">⌅</span> [61eb1bfa] + GPUCompiler v0.17.3
  [7693890a] + HTML_Entities v1.0.1
  [3cc741c3] + HuggingFaceApi v0.1.0
  [7869d1d1] + IRTools v0.4.12
  [615f187c] + IfElse v0.1.1
  [22cec73e] + InitialValues v0.3.1
  [7d512f48] + InternedStrings v0.7.0
  [0f8b85d8] + JSON3 v1.14.0
  [b14d175d] + JuliaVariables v0.2.4
  [63c18a36] + KernelAbstractions v0.9.18
<span class=" -Color -Color-Yellow">⌅</span> [929cbde3] + LLVM v4.17.1
  [9c8b4983] + LightXML v0.9.1
  [d8e11817] + MLStyle v0.4.17
<span class=" -Color -Color-Yellow">⌅</span> [f1d291b0] + MLUtils v0.3.1
<span class=" -Color -Color-Yellow">⌅</span> [128add7d] + MicroCollections v0.1.4
<span class=" -Color -Color-Yellow">⌅</span> [872c559c] + NNlib v0.8.21
<span class=" -Color -Color-Green">⌃</span> [a00861dc] + NNlibCUDA v0.2.6
  [71a1bf82] + NameResolution v0.1.5
<span class=" -Color -Color-Yellow">⌅</span> [12afc1b8] + NeuralAttentionlib v0.1.5
  [cf8be1f4] + OhMyArtifacts v0.3.1
<span class=" -Color -Color-Green">⌃</span> [0b1bfda6] + OneHotArrays v0.2.0
<span class=" -Color -Color-Yellow">⌅</span> [3bd65402] + Optimisers v0.2.15
  [570af359] + PartialFunctions v1.2.0
<span class=" -Color -Color-Green">⌃</span> [fbb45041] + Pickle v0.3.2
  [fa939f87] + Pidfile v1.3.0
  [8162dcfd] + PrettyPrint v0.2.0
  [13d12f88] + PrimitiveOneHot v0.1.4
  [33c8b6b6] + ProgressLogging v0.1.4
  [74087812] + Random123 v1.7.0
  [e6cf234a] + RandomNumbers v1.5.3
  [c1ae055f] + RealDot v0.1.0
  [605ecd9f] + ShowCases v0.1.0
  [699a6c99] + SimpleTraits v0.9.4
  [dc90abb0] + SparseInverseSubset v0.1.2
  [171d559e] + SplittablesBase v0.1.15
<span class=" -Color -Color-Yellow">⌅</span> [aedffcd0] + Static v0.7.8
  [9700d1a9] + StrTables v1.0.1
<span class=" -Color -Color-Yellow">⌅</span> [5e0ebb24] + Strided v1.2.3
  [69024149] + StringEncodings v0.3.7
  [354b36f9] + StringViews v1.3.3
  [09ab397b] + StructArrays v0.6.18
  [31cdf514] + StructWalk v0.2.1
<span class=" -Color -Color-Yellow">⌅</span> [f92c20c0] + TextEncodeBase v0.5.12
  [a759f4b9] + TimerOutputs v0.5.23
<span class=" -Color -Color-Green">⌃</span> [28d57a85] + Transducers v0.4.80
<span class=" -Color -Color-Green">⌃</span> [21ca0261] + Transformers v0.1.25
  [410a4b4d] + Tricks v0.1.8
  [9d95972d] + TupleTools v1.5.0
  [013be700] + UnsafeAtomics v0.2.1
<span class=" -Color -Color-Green">⌃</span> [d80eeb9a] + UnsafeAtomicsLLVM v0.1.1
  [0625e100] + ValSplit v0.1.1
  [796a5d58] + WordTokenizers v0.5.6
<span class=" -Color -Color-Yellow">⌅</span> [a5390f91] + ZipFile v0.9.4
  [e88e6eb3] + Zygote v0.6.69
  [700de1a5] + ZygoteRules v0.2.5
<span class=" -Color -Color-Yellow">⌅</span> [dad2f222] + LLVMExtra_jll v0.0.18+0
<span class=" -Color -Color-Bold -Color-Bold-Cyan">        Info</span> Packages marked with <span class=" -Color -Color-Green">⌃</span> and <span class=" -Color -Color-Yellow">⌅</span> have new versions available. Those with <span class=" -Color -Color-Green">⌃</span> may be upgradable, but those with <span class=" -Color -Color-Yellow">⌅</span> are restricted by compatibility constraints from upgrading. To see why use `status --outdated -m`
<span class=" -Color -Color-Bold -Color-Bold-Green">    Building</span> DataDeps ─────→ `~/.julia/scratchspaces/44cfe95a-1eb2-52ea-b672-e2afdf69b78f/e299d8267135ef2f9c941a764006697082c1e7e8/build.log`
<span class=" -Color -Color-Bold -Color-Bold-Green">    Building</span> HTML_Entities → `~/.julia/scratchspaces/44cfe95a-1eb2-52ea-b672-e2afdf69b78f/c4144ed3bc5f67f595622ad03c0e39fa6c70ccc7/build.log`
<span class=" -Color -Color-Bold -Color-Bold-Green">Precompiling</span> project...
<span class=" -Color -Color-Green">  ✓ </span>Tricks
<span class=" -Color -Color-Green">  ✓ </span>StringViews
<span class=" -Color -Color-Green">  ✓ </span>FunctionWrappers
<span class=" -Color -Color-Green">  ✓ </span>InitialValues
<span class=" -Color -Color-Green">  ✓ </span>CEnum
<span class=" -Color -Color-Green">  ✓ </span>StrTables
<span class=" -Color -Color-Green">  ✓ </span>PrettyPrint
<span class=" -Color -Color-Green">  ✓ </span>FuncPipelines
<span class=" -Color -Color-Green">  ✓ </span>ArgCheck
<span class=" -Color -Color-Green">  ✓ </span>UnsafeAtomics
<span class=" -Color -Color-Green">  ✓ </span>ShowCases
<span class=" -Color -Color-Green">  ✓ </span>RealDot
<span class=" -Color -Color-Green">  ✓ </span>InternedStrings
<span class=" -Color -Color-Green">  ✓ </span>Pidfile
<span class=" -Color -Color-Green">  ✓ </span>CompositionsBase
<span class=" -Color -Color-Green">  ✓ </span>BFloat16s
<span class=" -Color -Color-Green">  ✓ </span>AbstractTrees
<span class=" -Color -Color-Green">  ✓ </span>DefineSingletons
<span class=" -Color -Color-Green">  ✓ </span>IfElse
<span class=" -Color -Color-Green">  ✓ </span>Adapt
<span class=" -Color -Color-Green">  ✓ </span>ProgressLogging
<span class=" -Color -Color-Green">  ✓ </span>IRTools
<span class=" -Color -Color-Green">  ✓ </span>Functors
<span class=" -Color -Color-Green">  ✓ </span>TupleTools
<span class=" -Color -Color-Green">  ✓ </span>TimerOutputs
<span class=" -Color -Color-Green">  ✓ </span>SimpleTraits
<span class=" -Color -Color-Green">  ✓ </span>CommonSubexpressions
<span class=" -Color -Color-Green">  ✓ </span>Baselet
<span class=" -Color -Color-Green">  ✓ </span>PartialFunctions
  ✗ BinaryProvider
<span class=" -Color -Color-Green">  ✓ </span>ZipFile
<span class=" -Color -Color-Green">  ✓ </span>SparseInverseSubset
<span class=" -Color -Color-Green">  ✓ </span>RandomNumbers
<span class=" -Color -Color-Green">  ✓ </span>DiffResults
<span class=" -Color -Color-Green">  ✓ </span>LLVMExtra_jll
<span class=" -Color -Color-Green">  ✓ </span>ContextVariablesX
<span class=" -Color -Color-Green">  ✓ </span>StringEncodings
<span class=" -Color -Color-Green">  ✓ </span>StructWalk
<span class=" -Color -Color-Green">  ✓ </span>LightXML
<span class=" -Color -Color-Green">  ✓ </span>StructArrays
<span class=" -Color -Color-Green">  ✓ </span>SplittablesBase
<span class=" -Color -Color-Green">  ✓ </span>DiffRules
<span class=" -Color -Color-Green">  ✓ </span>ZygoteRules
<span class=" -Color -Color-Green">  ✓ </span>ValSplit
<span class=" -Color -Color-Green">  ✓ </span>HTML_Entities
<span class=" -Color -Color-Green">  ✓ </span>NameResolution
<span class=" -Color -Color-Green">  ✓ </span>Atomix
<span class=" -Color -Color-Yellow">  ? </span>Lathe
<span class=" -Color -Color-Green">  ✓ </span>OhMyArtifacts
<span class=" -Color -Color-Green">  ✓ </span>CompositionsBase → CompositionsBaseInverseFunctionsExt
<span class=" -Color -Color-Green">  ✓ </span>Static
<span class=" -Color -Color-Green">  ✓ </span>OffsetArrays → OffsetArraysAdaptExt
<span class=" -Color -Color-Green">  ✓ </span>Adapt → AdaptStaticArraysExt
<span class=" -Color -Color-Green">  ✓ </span>Strided
<span class=" -Color -Color-Green">  ✓ </span>DataDeps
<span class=" -Color -Color-Green">  ✓ </span>Optimisers
<span class=" -Color -Color-Green">  ✓ </span>FLoopsBase
<span class=" -Color -Color-Green">  ✓ </span>Random123
<span class=" -Color -Color-Green">  ✓ </span>JSON3
<span class=" -Color -Color-Green">  ✓ </span>BangBang
<span class=" -Color -Color-Green">  ✓ </span>Accessors
<span class=" -Color -Color-Green">  ✓ </span>GPUArraysCore
<span class=" -Color -Color-Green">  ✓ </span>DoubleArrayTries
<span class=" -Color -Color-Green">  ✓ </span>ForwardDiff
<span class=" -Color -Color-Green">  ✓ </span>LLVM
<span class=" -Color -Color-Green">  ✓ </span>MLStyle
<span class=" -Color -Color-Green">  ✓ </span>WordTokenizers
<span class=" -Color -Color-Green">  ✓ </span>Interpolations
<span class=" -Color -Color-Green">  ✓ </span>Pickle
<span class=" -Color -Color-Green">  ✓ </span>HuggingFaceApi
<span class=" -Color -Color-Green">  ✓ </span>Fetch
<span class=" -Color -Color-Green">  ✓ </span>Accessors → AccessorsStructArraysExt
<span class=" -Color -Color-Green">  ✓ </span>MicroCollections
<span class=" -Color -Color-Green">  ✓ </span>StructArrays → StructArraysGPUArraysCoreExt
<span class=" -Color -Color-Green">  ✓ </span>UnsafeAtomicsLLVM
<span class=" -Color -Color-Green">  ✓ </span>ForwardDiff → ForwardDiffStaticArraysExt
<span class=" -Color -Color-Green">  ✓ </span>GPUArrays
<span class=" -Color -Color-Green">  ✓ </span>Accessors → AccessorsStaticArraysExt
<span class=" -Color -Color-Green">  ✓ </span>Interpolations → InterpolationsUnitfulExt
<span class=" -Color -Color-Green">  ✓ </span>StructArrays → StructArraysStaticArraysExt
<span class=" -Color -Color-Green">  ✓ </span>JuliaVariables
<span class=" -Color -Color-Green">  ✓ </span>Accessors → AccessorsUnitfulExt
<span class=" -Color -Color-Green">  ✓ </span>StructArrays → StructArraysSparseArraysExt
<span class=" -Color -Color-Green">  ✓ </span>StructArrays → StructArraysAdaptExt
<span class=" -Color -Color-Green">  ✓ </span>KernelDensity
<span class=" -Color -Color-Green">  ✓ </span>Transducers
<span class=" -Color -Color-Green">  ✓ </span>KernelAbstractions
<span class=" -Color -Color-Green">  ✓ </span>Transducers → TransducersDataFramesExt
<span class=" -Color -Color-Green">  ✓ </span>FoldsThreads
<span class=" -Color -Color-Green">  ✓ </span>NNlib
<span class=" -Color -Color-Green">  ✓ </span>FLoops
<span class=" -Color -Color-Green">  ✓ </span>ChainRules
<span class=" -Color -Color-Green">  ✓ </span>PrimitiveOneHot
<span class=" -Color -Color-Green">  ✓ </span>TextEncodeBase
<span class=" -Color -Color-Green">  ✓ </span>GPUCompiler
<span class=" -Color -Color-Green">  ✓ </span>MLUtils
<span class=" -Color -Color-Green">  ✓ </span>BytePairEncoding
<span class=" -Color -Color-Green">  ✓ </span>OneHotArrays
<span class=" -Color -Color-Green">  ✓ </span>Zygote
<span class=" -Color -Color-Green">  ✓ </span>Zygote → ZygoteDistancesExt
<span class=" -Color -Color-Green">  ✓ </span>Zygote → ZygoteColorsExt
<span class=" -Color -Color-Green">  ✓ </span>CUDA
<span class=" -Color -Color-Green">  ✓ </span>NNlibCUDA
<span class=" -Color -Color-Green">  ✓ </span>NeuralAttentionlib
<span class=" -Color -Color-Green">  ✓ </span>Flux
<span class=" -Color -Color-Green">  ✓ </span>Transformers
<span class=" -Color -Color-Green">  ✓ </span>StatsPlots
  105 dependencies successfully precompiled in 123 seconds. 279 already precompiled.
  <span class=" -Color -Color-Yellow">1</span> dependency failed but may be precompilable after restarting julia
  <span class=" -Color -Color-Yellow">2</span> dependencies had output during precompilation:
<span class=" -Color -Color-Yellow">┌ </span>BFloat16s
<span class=" -Color -Color-Yellow">│  </span>WARNING: could not import Printf.ini_hex into BFloat16s
<span class=" -Color -Color-Yellow">│  </span>WARNING: could not import Printf.ini_HEX into BFloat16s
<span class=" -Color -Color-Yellow">└  </span>
<span class=" -Color -Color-Yellow">┌ </span>Lathe
<span class=" -Color -Color-Yellow">│  </span>WARNING: Method definition PowerLog(Float64, Float64) in module models at /Users/valerie/.julia/packages/Lathe/ZRJQf/src/models/toolbox.jl:14 overwritten on the same line (check for duplicate calls to `include`).
<span class=" -Color -Color-Yellow">│  </span>ERROR: Method overwriting is not permitted during Module precompilation. Use `__precompile__(false)` to opt-out of precompilation.
<span class=" -Color -Color-Yellow">└  </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Pkg</span>
<span class="k">using</span><span class="w"> </span><span class="n">RData</span>
<span class="k">using</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">using</span><span class="w"> </span><span class="n">RDatasets</span>
<span class="k">using</span><span class="w"> </span><span class="n">Random</span>
<span class="k">using</span><span class="w"> </span><span class="n">StatsBase</span>
<span class="k">using</span><span class="w"> </span><span class="n">GLM</span>
<span class="k">using</span><span class="w"> </span><span class="n">PyCall</span>
<span class="k">using</span><span class="w"> </span><span class="n">Statistics</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>
<span class="k">using</span><span class="w"> </span><span class="n">CSV</span>
<span class="k">using</span><span class="w"> </span><span class="n">Transformers</span>

<span class="k">import</span><span class="w"> </span><span class="n">PyPlot</span>
<span class="k">import</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">import</span><span class="w"> </span><span class="n">StatsModels</span>
<span class="k">import</span><span class="w"> </span><span class="n">Random</span>
<span class="k">import</span><span class="w"> </span><span class="n">ScikitLearn</span><span class="o">:</span><span class="w"> </span><span class="n">cross_val_score</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">Precompiling</span> Transformers
  ✗ BinaryProvider
  0 dependencies successfully precompiled in 2 seconds. 183 already precompiled.
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Precompiling Transformers [21ca0261-441d-5938-ace7-c90938fde4d4]
<span class=" -Color -Color-Bold -Color-Bold-Yellow">┌ Warning: </span>Module HTTP with build ID fafbfcfd-fb7e-58a8-0000-0286b56ffd08 is missing from the cache.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">│ </span>This may mean HTTP [cd3eb016-35fb-5094-929b-558a96fad6f3] does not support precompilation but is imported by a module that does.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">└ </span>@ Base loading.jl:1948
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Skipping precompilation since __precompile__(false). Importing Transformers [21ca0261-441d-5938-ace7-c90938fde4d4].
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Precompiling ZygoteColorsExt [e68c091a-8ea5-5ca7-be4f-380657d4ad79]
<span class=" -Color -Color-Bold -Color-Bold-Yellow">┌ Warning: </span>Module Colors with build ID fafbfcfd-6f69-f41e-0000-2644de38854d is missing from the cache.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">│ </span>This may mean Colors [5ae59095-9a9b-59fe-a467-6f913c188581] does not support precompilation but is imported by a module that does.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">└ </span>@ Base loading.jl:1948
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Skipping precompilation since __precompile__(false). Importing ZygoteColorsExt [e68c091a-8ea5-5ca7-be4f-380657d4ad79].
<span class=" -Color -Color-Bold -Color-Bold-Green">Precompiling</span> TextEncodeBase
  ✗ BinaryProvider
  0 dependencies successfully precompiled in 3 seconds. 47 already precompiled.
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Precompiling TextEncodeBase [f92c20c0-9f2a-4705-8116-881385faba05]
<span class=" -Color -Color-Bold -Color-Bold-Yellow">┌ Warning: </span>Module HTTP with build ID fafbfcfd-fb7e-58a8-0000-0286b56ffd08 is missing from the cache.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">│ </span>This may mean HTTP [cd3eb016-35fb-5094-929b-558a96fad6f3] does not support precompilation but is imported by a module that does.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">└ </span>@ Base loading.jl:1948
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Skipping precompilation since __precompile__(false). Importing TextEncodeBase [f92c20c0-9f2a-4705-8116-881385faba05].
<span class=" -Color -Color-Bold -Color-Bold-Green">Precompiling</span> WordTokenizers
  ✗ BinaryProvider
  0 dependencies successfully precompiled in 1 seconds. 9 already precompiled.
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Precompiling WordTokenizers [796a5d58-b03d-544a-977e-18100b691f6e]
<span class=" -Color -Color-Bold -Color-Bold-Yellow">┌ Warning: </span>Module HTTP with build ID fafbfcfd-fb7e-58a8-0000-0286b56ffd08 is missing from the cache.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">│ </span>This may mean HTTP [cd3eb016-35fb-5094-929b-558a96fad6f3] does not support precompilation but is imported by a module that does.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">└ </span>@ Base loading.jl:1948
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Skipping precompilation since __precompile__(false). Importing WordTokenizers [796a5d58-b03d-544a-977e-18100b691f6e].
<span class=" -Color -Color-Bold -Color-Bold-Green">Precompiling</span> DataDeps
  ✗ BinaryProvider
  0 dependencies successfully precompiled in 27 seconds. 6 already precompiled.
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Precompiling DataDeps [124859b0-ceae-595e-8997-d05f6a7a8dfe]
<span class=" -Color -Color-Bold -Color-Bold-Yellow">┌ Warning: </span>Module HTTP with build ID fafbfcfd-fb7e-58a8-0000-0286b56ffd08 is missing from the cache.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">│ </span>This may mean HTTP [cd3eb016-35fb-5094-929b-558a96fad6f3] does not support precompilation but is imported by a module that does.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">└ </span>@ Base loading.jl:1948
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Skipping precompilation since __precompile__(false). Importing DataDeps [124859b0-ceae-595e-8997-d05f6a7a8dfe].
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Precompiling Fetch [bb354801-46f6-40b6-9c3d-d42d7a74c775]
<span class=" -Color -Color-Bold -Color-Bold-Yellow">┌ Warning: </span>Module HTTP with build ID fafbfcfd-fb7e-58a8-0000-0286b56ffd08 is missing from the cache.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">│ </span>This may mean HTTP [cd3eb016-35fb-5094-929b-558a96fad6f3] does not support precompilation but is imported by a module that does.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">└ </span>@ Base loading.jl:1948
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Skipping precompilation since __precompile__(false). Importing Fetch [bb354801-46f6-40b6-9c3d-d42d7a74c775].
<span class=" -Color -Color-Bold -Color-Bold-Green">Precompiling</span> BytePairEncoding
  ✗ BinaryProvider
  0 dependencies successfully precompiled in 1 seconds. 48 already precompiled.
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Precompiling BytePairEncoding [a4280ba5-8788-555a-8ca8-4a8c3d966a71]
<span class=" -Color -Color-Bold -Color-Bold-Yellow">┌ Warning: </span>Module TextEncodeBase with build ID ffffffff-ffff-ffff-0000-2ecbcb9e8568 is missing from the cache.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">│ </span>This may mean TextEncodeBase [f92c20c0-9f2a-4705-8116-881385faba05] does not support precompilation but is imported by a module that does.
<span class=" -Color -Color-Bold -Color-Bold-Yellow">└ </span>@ Base loading.jl:1948
<span class=" -Color -Color-Bold -Color-Bold-Cyan">[ Info: </span>Skipping precompilation since __precompile__(false). Importing BytePairEncoding [a4280ba5-8788-555a-8ca8-4a8c3d966a71].
WARNING: could not import ScikitLearn.cross_val_score into Main
</pre></div>
</div>
</div>
</div>
<p><strong>1. Data Preparation</strong></p>
<p>Load the March Supplement of the U.S. Current Population Survey, year 2015. (wage2015_subsample_inference.Rdata)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">rdata_read</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RData</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;../../data/wage2015_subsample_inference.RData&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdata_read</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">]</span>
<span class="n">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20-element Vector{String}:
 &quot;wage&quot;
 &quot;lwage&quot;
 &quot;sex&quot;
 &quot;shs&quot;
 &quot;hsg&quot;
 &quot;scl&quot;
 &quot;clg&quot;
 &quot;ad&quot;
 &quot;mw&quot;
 &quot;so&quot;
 &quot;we&quot;
 &quot;ne&quot;
 &quot;exp1&quot;
 &quot;exp2&quot;
 &quot;exp3&quot;
 &quot;exp4&quot;
 &quot;occ&quot;
 &quot;occ2&quot;
 &quot;ind&quot;
 &quot;ind2&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># a quick description of the data</span>
<span class="n">describe</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="data-frame"><thead><tr><th></th><th>variable</th><th>mean</th><th>min</th><th>median</th><th>max</th><th>nmissing</th><th>eltype</th></tr><tr><th></th><th>Symbol</th><th>Union…</th><th>Any</th><th>Union…</th><th>Any</th><th>Int64</th><th>DataType</th></tr></thead><tbody><p>20 rows × 7 columns</p><tr><th>1</th><td>wage</td><td>23.4104</td><td>3.02198</td><td>19.2308</td><td>528.846</td><td>0</td><td>Float64</td></tr><tr><th>2</th><td>lwage</td><td>2.97079</td><td>1.10591</td><td>2.95651</td><td>6.2707</td><td>0</td><td>Float64</td></tr><tr><th>3</th><td>sex</td><td>0.444466</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>4</th><td>shs</td><td>0.023301</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>5</th><td>hsg</td><td>0.243883</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>6</th><td>scl</td><td>0.278058</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>7</th><td>clg</td><td>0.31767</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>8</th><td>ad</td><td>0.137087</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>9</th><td>mw</td><td>0.259612</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>10</th><td>so</td><td>0.296505</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>11</th><td>we</td><td>0.216117</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>12</th><td>ne</td><td>0.227767</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0</td><td>Float64</td></tr><tr><th>13</th><td>exp1</td><td>13.7606</td><td>0.0</td><td>10.0</td><td>47.0</td><td>0</td><td>Float64</td></tr><tr><th>14</th><td>exp2</td><td>3.01893</td><td>0.0</td><td>1.0</td><td>22.09</td><td>0</td><td>Float64</td></tr><tr><th>15</th><td>exp3</td><td>8.23587</td><td>0.0</td><td>1.0</td><td>103.823</td><td>0</td><td>Float64</td></tr><tr><th>16</th><td>exp4</td><td>25.118</td><td>0.0</td><td>1.0</td><td>487.968</td><td>0</td><td>Float64</td></tr><tr><th>17</th><td>occ</td><td></td><td>10</td><td></td><td>1e+05</td><td>0</td><td>CategoricalValue{String, UInt16}</td></tr><tr><th>18</th><td>occ2</td><td></td><td>1</td><td></td><td>22</td><td>0</td><td>CategoricalValue{String, UInt8}</td></tr><tr><th>19</th><td>ind</td><td></td><td>370</td><td></td><td>1e+05</td><td>0</td><td>CategoricalValue{String, UInt8}</td></tr><tr><th>20</th><td>ind2</td><td></td><td>2</td><td></td><td>22</td><td>0</td><td>CategoricalValue{String, UInt8}</td></tr></tbody></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># flexible model</span>
<span class="c"># flex = @formula(lwage ~ sex + shs + hsg + scl + clg + occ2 + ind2 + mw + so + we + (exp1 + exp2 + exp3 + exp4) * (shs + hsg + scl + clg + occ2 + ind2 + mw + so + we))</span>
<span class="c"># flex_results_0 = lm(flex, data)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># # Get exogenous variables (X matrix) from the flexible model</span>
<span class="c"># X = Matrix(modelmatrix(flex_results_0))</span>

<span class="c"># # Set endogenous variable (response variable)</span>
<span class="c"># y = data[!, &quot;lwage&quot;]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">partitionTrainTest</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.7</span><span class="p">)</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="w">    </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="n">train_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">view</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">floor</span><span class="p">(</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">at</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>
<span class="w">    </span><span class="n">test_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">view</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">at</span><span class="o">*</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">:</span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="n">data</span><span class="p">[</span><span class="n">train_idx</span><span class="p">,</span><span class="o">:</span><span class="p">],</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">test_idx</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">iris</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataset</span><span class="p">(</span><span class="s">&quot;datasets&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;iris&quot;</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span><span class="n">X_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partitionTrainTest</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7</span><span class="p">)</span><span class="w"> </span><span class="c"># 70% train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(<span class=" -Color -Color-Bold">105×5 DataFrame</span>
<span class=" -Color -Color-Bold"> Row </span>│<span class=" -Color -Color-Bold"> SepalLength  SepalWidth  PetalLength  PetalWidth  Species    </span>
<span class=" -Color -Color-Bold">     </span>│ Float64      Float64     Float64      Float64     Cat…       
─────┼──────────────────────────────────────────────────────────────
   1 │         6.1         3.0          4.9         1.8  virginica
   2 │         5.5         2.6          4.4         1.2  versicolor
   3 │         5.6         2.7          4.2         1.3  versicolor
   4 │         5.3         3.7          1.5         0.2  setosa
   5 │         6.2         2.2          4.5         1.5  versicolor
   6 │         7.7         3.8          6.7         2.2  virginica
   7 │         6.5         2.8          4.6         1.5  versicolor
   8 │         6.6         2.9          4.6         1.3  versicolor
   9 │         5.5         3.5          1.3         0.2  setosa
  10 │         6.0         2.9          4.5         1.5  versicolor
  11 │         5.5         2.3          4.0         1.3  versicolor
  ⋮  │      ⋮           ⋮            ⋮           ⋮           ⋮
  96 │         5.8         2.7          5.1         1.9  virginica
  97 │         7.6         3.0          6.6         2.1  virginica
  98 │         6.5         3.0          5.5         1.8  virginica
  99 │         6.7         3.1          4.4         1.4  versicolor
 100 │         5.6         2.9          3.6         1.3  versicolor
 101 │         6.8         3.0          5.5         2.1  virginica
 102 │         6.1         3.0          4.6         1.4  versicolor
 103 │         5.2         3.4          1.4         0.2  setosa
 104 │         6.5         3.0          5.8         2.2  virginica
 105 │         6.2         2.8          4.8         1.8  virginica
<span class=" -Color -Color-Cyan">                                                     84 rows omitted</span>, <span class=" -Color -Color-Bold">45×5 DataFrame</span>
<span class=" -Color -Color-Bold"> Row </span>│<span class=" -Color -Color-Bold"> SepalLength  SepalWidth  PetalLength  PetalWidth  Species    </span>
<span class=" -Color -Color-Bold">     </span>│ Float64      Float64     Float64      Float64     Cat…       
─────┼──────────────────────────────────────────────────────────────
   1 │         6.1         2.8          4.7         1.2  versicolor
   2 │         5.0         3.0          1.6         0.2  setosa
   3 │         6.3         2.3          4.4         1.3  versicolor
   4 │         4.4         3.0          1.3         0.2  setosa
   5 │         4.6         3.2          1.4         0.2  setosa
   6 │         5.0         3.2          1.2         0.2  setosa
   7 │         6.7         3.0          5.2         2.3  virginica
   8 │         5.1         3.8          1.9         0.4  setosa
   9 │         4.8         3.0          1.4         0.1  setosa
  10 │         5.2         3.5          1.5         0.2  setosa
  11 │         5.1         3.8          1.6         0.2  setosa
  ⋮  │      ⋮           ⋮            ⋮           ⋮           ⋮
  36 │         5.7         3.8          1.7         0.3  setosa
  37 │         5.6         3.0          4.5         1.5  versicolor
  38 │         6.3         2.5          5.0         1.9  virginica
  39 │         4.8         3.1          1.6         0.2  setosa
  40 │         6.0         3.4          4.5         1.6  versicolor
  41 │         4.8         3.4          1.6         0.2  setosa
  42 │         6.7         3.0          5.0         1.7  versicolor
  43 │         5.9         3.0          5.1         1.8  virginica
  44 │         5.0         3.5          1.6         0.6  setosa
  45 │         6.3         3.4          5.6         2.4  virginica
<span class=" -Color -Color-Cyan">                                                     24 rows omitted</span>)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StandardScaler</span><span class="p">()</span>

<span class="c"># Fit and transform on training data</span>
<span class="n">X_train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MLJ</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">scaler</span><span class="p">,</span><span class="w"> </span><span class="n">X_train</span><span class="p">)</span>

<span class="c"># Transform test data using the same scaler</span>
<span class="n">X_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MLJ</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">scaler</span><span class="p">,</span><span class="w"> </span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">UndefVarError</span>: `StandardScaler` not defined

<span class="ne">Stacktrace</span>:
 <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
   <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">102</span><span class="p">]:</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p><strong>2. Define a Range of Alpha (Lambda in our equation) Values</strong></p>
<p>We create a list or array of alpha values to iterate over. These will be the different regularization parameters we test. We started testing from 0.1 to 0.5 and found that the MSE in cross-validation was reducing when the alpha value was incrementing. Therefore, we tried with higher values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Create alphas using a loop</span>
<span class="n">alphas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">45</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><strong>3. Partition the Dataset for k-Fold Cross-Validation</strong></p>
<p>We divide the dataset into 5 subsets (or folds). Since we are working with a regression task (predicting the log of wage), we use the K-Fold cross-validator from sklearn. We ensure the data is shuffled by adding ‘shuffle=True’ and set a random state for a reproducible output.</p>
<p>Source: <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.KFold.html">https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.KFold.html</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Create KFold</span>
<span class="n">kf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">shuffle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">random_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>4. Lasso Regression Implementation</strong></p>
<p>Implement a function to fit a Lasso Regression model given a training dataset and an alpha value. The function should return the model’s coefficients and intercept.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">lasso_regression</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="w"> </span><span class="n">y_train</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    Fits a Lasso Regression model</span>

<span class="s">    Args:</span>
<span class="s">        X_train: Training features</span>
<span class="s">        y_train: Target values</span>
<span class="s">        alpha: Regularization parameter (L1 penalty)</span>
<span class="s">        iterations: Number of iterations for gradient descent (default: 100)</span>
<span class="s">        learning_rate: Learning rate for gradient descent (default: 0.01)</span>

<span class="s">    Returns:</span>
<span class="s">        W: Model coefficients (weights)</span>
<span class="s">        b: Model intercept (bias)</span>
<span class="s">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="w">    </span><span class="n">W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">iterations</span>
<span class="w">        </span><span class="n">Y_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X_train</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">W</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">b</span>
<span class="w">        </span><span class="n">dW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">W</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                </span><span class="n">dW</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="n">y_train</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Y_pred</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">m</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">dW</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="n">y_train</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Y_pred</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">m</span>
<span class="w">            </span><span class="k">end</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">        </span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">y_train</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Y_pred</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">m</span>
<span class="w">        </span><span class="n">W</span><span class="w"> </span><span class="o">.-=</span><span class="w"> </span><span class="n">learning_rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dW</span>
<span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">learning_rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">db</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<p><strong>5. Cross-Validation Loop and 6. Selection of Optimal Alpha</strong></p>
<p>We immplement a for loop to fit the lasso regression. Also, we find the best value of alpha that reduces the average MSE for each fold.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">cross_validate_lasso</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="w"> </span><span class="n">y_train</span><span class="p">,</span><span class="w"> </span><span class="n">alphas</span><span class="p">,</span><span class="w"> </span><span class="n">kf</span><span class="p">)</span>
<span class="w">    </span><span class="n">avg_mse_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Float64</span><span class="p">[]</span>
<span class="w">    </span><span class="n">best_alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nothing</span>
<span class="w">    </span><span class="n">min_avg_mse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Inf</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">alphas</span>
<span class="w">        </span><span class="n">mse_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Float64</span><span class="p">[]</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">train_index</span><span class="p">,</span><span class="w"> </span><span class="n">val_index</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">kf</span>
<span class="w">            </span><span class="n">X_train_fold</span><span class="p">,</span><span class="w"> </span><span class="n">X_val_fold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X_train</span><span class="p">[</span><span class="n">train_index</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="p">],</span><span class="w"> </span><span class="n">X_train</span><span class="p">[</span><span class="n">val_index</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="p">]</span>
<span class="w">            </span><span class="n">y_train_fold</span><span class="p">,</span><span class="w"> </span><span class="n">y_val_fold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_train</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span><span class="w"> </span><span class="n">y_train</span><span class="p">[</span><span class="n">val_index</span><span class="p">]</span>

<span class="w">            </span><span class="c"># Train Lasso regression model with the current alpha</span>
<span class="w">            </span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso_regression</span><span class="p">(</span><span class="n">X_train_fold</span><span class="p">,</span><span class="w"> </span><span class="n">y_train_fold</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">)</span>
<span class="w">            </span><span class="n">y_pred_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X_val_fold</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">W</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">b</span>

<span class="w">            </span><span class="c"># Calculate MSE for this fold</span>
<span class="w">            </span><span class="n">mse_fold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">((</span><span class="n">y_val_fold</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">y_pred_val</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span>
<span class="w">            </span><span class="n">push!</span><span class="p">(</span><span class="n">mse_list</span><span class="p">,</span><span class="w"> </span><span class="n">mse_fold</span><span class="p">)</span>
<span class="w">        </span><span class="k">end</span>

<span class="w">        </span><span class="c"># Calculate average MSE across all folds</span>
<span class="w">        </span><span class="n">avg_mse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">mse_list</span><span class="p">)</span>
<span class="w">        </span><span class="n">push!</span><span class="p">(</span><span class="n">avg_mse_values</span><span class="p">,</span><span class="w"> </span><span class="n">avg_mse</span><span class="p">)</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Alpha=</span><span class="si">$</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="s">, Average MSE: </span><span class="si">$</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">avg_mse</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c"># Update the best alpha and minimum average MSE</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">avg_mse</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">min_avg_mse</span>
<span class="w">            </span><span class="n">min_avg_mse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">avg_mse</span>
<span class="w">            </span><span class="n">best_alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alpha</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Best Alpha: </span><span class="si">$</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">best_alpha</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="s">, Minimum Average MSE: </span><span class="si">$</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">min_avg_mse</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c"># Plotting the cross-validated MSE for each alpha value</span>
<span class="w">    </span><span class="n">plt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="w"> </span><span class="n">avg_mse_values</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:o</span><span class="p">,</span><span class="w"> </span><span class="n">linestyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:solid</span><span class="p">,</span><span class="w"> </span><span class="n">xlabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Alpha&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Average MSE&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Cross-Validated MSE for Different Alpha Values&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>
<span class="w">    </span><span class="n">xticks!</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span><span class="w"> </span><span class="n">alphas</span><span class="p">)</span>
<span class="w">    </span><span class="n">grid!</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span>
<span class="w">    </span><span class="n">display</span><span class="p">(</span><span class="n">plt</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<p><strong>7. Model Training and Evaluation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Train Lasso regression model with the best alpha</span>
<span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso_regression</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="w"> </span><span class="n">y_train</span><span class="p">,</span><span class="w"> </span><span class="n">best_alpha</span><span class="p">)</span>

<span class="c"># Make predictions on test data</span>
<span class="n">y_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X_test</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">W</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">b</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">lasso_corr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cor</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span>
<span class="n">lasso_mae</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">abs</span><span class="o">.</span><span class="p">(</span><span class="n">y_test</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">y_pred</span><span class="p">))</span>
<span class="n">lasso_mse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span>

<span class="c"># Print results</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;Correlation: </span><span class="si">$</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">lasso_corr</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;MAE: </span><span class="si">$</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">lasso_mae</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;MSE: </span><span class="si">$</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">lasso_mse</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span><span class="s">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>8. Report Results</strong></p>
<p>We began by selecting the parameters for a flexible model, one that includes interactions. After selecting the parameters, we found that the alpha value that produced the lowest mean squared error (MSE) in cross-validation was 60. We then trained the model using all the available training data with the best alpha value. Using the fitted betas, we predicted the lwage using the test X vector. The resulting MSE in the test data was 0.3569, which was lower than in the training data (which was 0.41906). This indicates that the model is not overfitting and that we have found a good correlation score (R square) of 50%.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Wage</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Statistics</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>


<span class="n">wage_sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">wage</span><span class="p">)</span>
<span class="n">cumulative_sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cumsum</span><span class="p">(</span><span class="n">wage_sorted</span><span class="p">)</span>
<span class="n">deciles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">percentile</span><span class="p">(</span><span class="n">cumulative_sum</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span><span class="mi">100</span><span class="p">]</span>
<span class="n">population_fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="mi">0</span><span class="o">:</span><span class="mf">0.1</span><span class="o">:</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Calcular la fracción acumulativa de salarios</span>
<span class="n">salary_fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">percentile</span><span class="p">(</span><span class="n">deciles</span><span class="w"> </span><span class="o">./</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">wage</span><span class="p">),</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span><span class="mi">100</span><span class="p">]</span>

<span class="c"># Graficar la curva de Lorenz</span>
<span class="n">plot</span><span class="p">(</span><span class="n">population_fraction</span><span class="p">,</span><span class="w"> </span><span class="n">salary_fraction</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:blue</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">linestyle</span><span class="o">=</span><span class="ss">:dash</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:red</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Equality line&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Lorenz Curve for Higher Education Salaries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;Cumulative fraction of the population&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;Cumulative fraction of salaries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">legend</span><span class="o">=</span><span class="ss">:bottomright</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">LwAGE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Plots</span>
<span class="k">using</span><span class="w"> </span><span class="n">StatsPlots</span>

<span class="c"># Configurar el estilo</span>
<span class="n">default</span><span class="p">(;</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>

<span class="c"># Crear el histograma de los salarios</span>
<span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lwage</span><span class="p">,</span><span class="w"> </span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:lightblue</span><span class="p">,</span><span class="w"> </span><span class="n">edgecolor</span><span class="o">=</span><span class="ss">:black</span><span class="p">,</span><span class="w"> </span><span class="n">normed</span><span class="o">=</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;Lwage&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;Density&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Histogram of Salaries&quot;</span><span class="p">)</span>

<span class="c"># Crear la función de densidad</span>
<span class="n">density!</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lwage</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:red</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Sex</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;PyPlot&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Distributions&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">using</span><span class="w"> </span><span class="n">Statistics</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>

<span class="c"># Calcular las proporciones de sexos</span>
<span class="n">proportions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">groupby</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="ss">:sex</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">:count</span><span class="p">)</span>

<span class="c"># Calcular el total de observaciones</span>
<span class="n">total_obs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">proportions</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>

<span class="c"># Asignar etiquetas &#39;Male&#39; y &#39;Female&#39;</span>
<span class="n">proportions</span><span class="p">[</span><span class="o">!</span><span class="p">,</span><span class="w"> </span><span class="ss">:sex_label</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="o">.</span><span class="p">(</span><span class="n">proportions</span><span class="o">.</span><span class="n">sex</span><span class="w"> </span><span class="o">.==</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Male&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Female&quot;</span><span class="p">)</span>

<span class="c"># Calcular las proporciones</span>
<span class="n">proportions</span><span class="p">[</span><span class="o">!</span><span class="p">,</span><span class="w"> </span><span class="ss">:percentage</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">proportions</span><span class="o">.</span><span class="n">count</span><span class="w"> </span><span class="o">./</span><span class="w"> </span><span class="n">total_obs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span>

<span class="c"># Graficar las proporciones sin leyenda</span>
<span class="n">display</span><span class="p">(</span><span class="n">bar</span><span class="p">(</span><span class="n">proportions</span><span class="o">.</span><span class="n">sex_label</span><span class="p">,</span><span class="w"> </span><span class="n">proportions</span><span class="p">[</span><span class="o">!</span><span class="p">,</span><span class="w"> </span><span class="ss">:percentage</span><span class="p">],</span>
<span class="w">    </span><span class="n">xlabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Sex&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Percentage&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Proportion of Males and Females&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">ylims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">bar_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">    </span><span class="n">fmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:png</span><span class="p">))</span>

<span class="c"># Mostrar el número total de observaciones</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;Total observations: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">total_obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Dummies</span><span class="w"> </span><span class="n">college</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">using</span><span class="w"> </span><span class="n">Statistics</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>

<span class="c"># Crear la variable &#39;Education_Status&#39;</span>
<span class="n">data</span><span class="p">[</span><span class="o">!</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Education_Status&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">.=</span><span class="w"> </span><span class="n">ifelse</span><span class="o">.</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">scl</span><span class="w"> </span><span class="o">.==</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Some College&quot;</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">ifelse</span><span class="o">.</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">clg</span><span class="w"> </span><span class="o">.==</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;College Graduate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Advanced Degree&quot;</span><span class="p">))</span>

<span class="c"># Calcular la frecuencia de educación</span>
<span class="n">edu_freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">groupby</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="ss">:Education_Status</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">:Frequency</span><span class="p">)</span>

<span class="c"># Calcular el total de observaciones</span>
<span class="n">total_obs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">edu_freq</span><span class="o">.</span><span class="n">Frequency</span><span class="p">)</span>

<span class="c"># Calcular el porcentaje</span>
<span class="n">edu_freq</span><span class="p">[</span><span class="o">!</span><span class="p">,</span><span class="w"> </span><span class="ss">:Percentage</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">edu_freq</span><span class="o">.</span><span class="n">Frequency</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total_obs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span>

<span class="c"># Definir colores y etiquetas</span>
<span class="c"># Crear el gráfico de pastel</span>
<span class="n">pie</span><span class="p">(</span><span class="n">edu_freq</span><span class="o">.</span><span class="n">Frequency</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="o">.</span><span class="p">(</span><span class="n">edu_freq</span><span class="o">.</span><span class="n">Percentage</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;%&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Education Status Distribution&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">legend</span><span class="o">=</span><span class="ss">:topright</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">fmt</span><span class="o">=</span><span class="ss">:png</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">pct</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>

<span class="c"># Añadir el número total de observaciones</span>
<span class="n">annotate!</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Total observations: </span><span class="si">$total_obs</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">halign</span><span class="o">=</span><span class="ss">:center</span><span class="p">,</span><span class="w"> </span><span class="n">valign</span><span class="o">=</span><span class="ss">:center</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Experience</span><span class="w"> </span><span class="n">Higher</span><span class="w"> </span><span class="n">Education</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>

<span class="n">plt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">))</span>
<span class="n">boxplot!</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">exp1</span><span class="p">,</span><span class="w"> </span><span class="n">box</span><span class="o">=</span><span class="ss">:box</span><span class="p">,</span><span class="w"> </span><span class="n">whiskerwidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Distribution of Experience in Individuals with Higher Education&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;Experience (exp1)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="nb">false</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">COEFFICIENTS</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">DIFFERENT</span><span class="w"> </span><span class="n">MODELS</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">using</span><span class="w"> </span><span class="n">GLM</span>
<span class="k">using</span><span class="w"> </span><span class="n">Statistics</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>


<span class="c"># Ajustar los modelos</span>
<span class="n">flex_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@formula</span><span class="p">(</span><span class="n">lwage</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">exp1</span><span class="o">+</span><span class="n">exp2</span><span class="o">+</span><span class="n">exp3</span><span class="o">+</span><span class="n">exp4</span><span class="o">+</span><span class="n">scl</span><span class="o">+</span><span class="n">clg</span><span class="o">+</span><span class="n">ad</span><span class="o">+</span><span class="n">occ2</span><span class="o">+</span><span class="n">ind2</span><span class="o">+</span><span class="n">mw</span><span class="o">+</span><span class="n">so</span><span class="o">+</span><span class="n">we</span><span class="o">+</span><span class="p">(</span><span class="n">exp1</span><span class="o">+</span><span class="n">exp2</span><span class="o">+</span><span class="n">exp3</span><span class="o">+</span><span class="n">exp4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">scl</span><span class="o">+</span><span class="n">clg</span><span class="o">+</span><span class="n">ad</span><span class="o">+</span><span class="n">occ2</span><span class="o">+</span><span class="n">ind2</span><span class="o">+</span><span class="n">mw</span><span class="o">+</span><span class="n">so</span><span class="o">+</span><span class="n">we</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c"># modelo para Y</span>
<span class="n">flex_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@formula</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">exp1</span><span class="o">+</span><span class="n">exp2</span><span class="o">+</span><span class="n">exp3</span><span class="o">+</span><span class="n">exp4</span><span class="o">+</span><span class="n">scl</span><span class="o">+</span><span class="n">clg</span><span class="o">+</span><span class="n">ad</span><span class="o">+</span><span class="n">occ2</span><span class="o">+</span><span class="n">ind2</span><span class="o">+</span><span class="n">mw</span><span class="o">+</span><span class="n">so</span><span class="o">+</span><span class="n">we</span><span class="o">+</span><span class="p">(</span><span class="n">exp1</span><span class="o">+</span><span class="n">exp2</span><span class="o">+</span><span class="n">exp3</span><span class="o">+</span><span class="n">exp4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">scl</span><span class="o">+</span><span class="n">clg</span><span class="o">+</span><span class="n">ad</span><span class="o">+</span><span class="n">occ2</span><span class="o">+</span><span class="n">ind2</span><span class="o">+</span><span class="n">mw</span><span class="o">+</span><span class="n">so</span><span class="o">+</span><span class="n">we</span><span class="p">))</span><span class="w">  </span><span class="c"># modelo para D</span>

<span class="c"># Ajustar el efecto lineal parcial de W desde Y</span>
<span class="n">t_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">residuals</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">flex_y</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">))</span>
<span class="c"># Ajustar el efecto lineal parcial de W desde D</span>
<span class="n">t_D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">residuals</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">flex_d</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">))</span>
<span class="c"># Crear un nuevo DataFrame con las variables relevantes para t_Y y t_D</span>
<span class="n">residuals_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataFrame</span><span class="p">(</span><span class="n">t_Y</span><span class="o">=</span><span class="n">t_Y</span><span class="p">,</span><span class="w"> </span><span class="n">t_D</span><span class="o">=</span><span class="n">t_D</span><span class="p">)</span>

<span class="c"># Ajustar la regresión lineal entre t_Y y t_D</span>
<span class="n">partial_fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="nd">@formula</span><span class="p">(</span><span class="n">t_D</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">t_Y</span><span class="p">),</span><span class="w"> </span><span class="n">residuals_df</span><span class="p">)</span>

<span class="c"># Ajustar los modelos</span>
<span class="n">basic_fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="nd">@formula</span><span class="p">(</span><span class="n">lwage</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">exp1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">clg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ad</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">occ2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ind2</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>

<span class="n">control_fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="nd">@formula</span><span class="p">(</span><span class="n">lwage</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">exp1</span><span class="o">+</span><span class="n">exp2</span><span class="o">+</span><span class="n">exp3</span><span class="o">+</span><span class="n">exp4</span><span class="o">+</span><span class="n">scl</span><span class="o">+</span><span class="n">clg</span><span class="o">+</span><span class="n">ad</span><span class="o">+</span><span class="n">occ2</span><span class="o">+</span><span class="n">ind2</span><span class="o">+</span><span class="n">mw</span><span class="o">+</span><span class="n">so</span><span class="o">+</span><span class="n">we</span><span class="o">+</span><span class="p">(</span><span class="n">exp1</span><span class="o">+</span><span class="n">exp2</span><span class="o">+</span><span class="n">exp3</span><span class="o">+</span><span class="n">exp4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">scl</span><span class="o">+</span><span class="n">clg</span><span class="o">+</span><span class="n">ad</span><span class="o">+</span><span class="n">occ2</span><span class="o">+</span><span class="n">ind2</span><span class="o">+</span><span class="n">mw</span><span class="o">+</span><span class="n">so</span><span class="o">+</span><span class="n">we</span><span class="p">)),</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>

<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>

<span class="c"># Extraer los coeficientes para sex y los errores estándar de las últimas dos regresiones</span>
<span class="n">coefs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;Basic&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">basic_fit</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
<span class="w">             </span><span class="s">&quot;Controls&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">control_fit</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
<span class="w">             </span><span class="s">&quot;Partialling out&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">partial_fit</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span><span class="w">  </span><span class="c"># El coeficiente de interés es el segundo en partial_fit</span>

<span class="n">ses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;Basic&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">stderror</span><span class="p">(</span><span class="n">basic_fit</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
<span class="w">           </span><span class="s">&quot;Controls&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">stderror</span><span class="p">(</span><span class="n">control_fit</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
<span class="w">           </span><span class="s">&quot;Partialling out&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">stderror</span><span class="p">(</span><span class="n">partial_fit</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span><span class="w">  </span><span class="c"># El error estándar correspondiente al coeficiente de interés</span>

<span class="c"># Gráfico de dispersión con barras de error</span>
<span class="n">scatter_plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scatter</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span><span class="w"> </span><span class="n">yerr</span><span class="o">=</span><span class="mf">1.96</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">ses</span><span class="p">)),</span><span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;Model&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;Coefficient&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Effect of sex on lwage&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">markershape</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">markercolor</span><span class="o">=</span><span class="ss">:blue</span><span class="p">,</span><span class="w"> </span><span class="n">markerstrokecolor</span><span class="o">=</span><span class="ss">:black</span><span class="p">,</span>
<span class="w">    </span><span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">markeralpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c"># Línea horizontal en y=0</span>
<span class="n">hline!</span><span class="p">(</span><span class="n">scatter_plot</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">&quot;gray&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linestyle</span><span class="o">=</span><span class="ss">:dash</span><span class="p">)</span>

<span class="c"># Mostrar el gráfico</span>
<span class="n">display</span><span class="p">(</span><span class="n">scatter_plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#The coefficient associated with the gender variable, which indicates the prediction of being female on salary, is initially </span>
<span class="c"># negative. This suggests that, on average, women have lower salaries than men. However, after adding these controls, </span>
<span class="c"># such as work experience or educational level, the negative coefficient associated with the gender variable becomes </span>
<span class="c"># less negative.</span>
<span class="c"># </span>
<span class="c"># This change in the gender coefficient could be explained by the fact that the control variables are capturing</span>
<span class="c"># some of the variability in salaries that was previously incorrectly attributed to gender. This suggests </span>
<span class="c"># that additional factors, beyond gender, are influencing salaries, and the impact of gender on salaries </span>
<span class="c"># is less pronounced once these other variables are taken into account.Besides, both FWL and including control </span>
<span class="c"># variables in the regression model yield coefficient estimates for the variable of interest that reflect its net</span>
<span class="c"># impact on the dependent variable, once the effects of other explanatory variables have been taken into account.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="women-and-male-graph-quartic">
<h1>Women and male graph (quartic)<a class="headerlink" href="#women-and-male-graph-quartic" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;StatsModels&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Loess&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">using</span><span class="w"> </span><span class="n">Statistics</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>

<span class="c"># Supongamos que tienes un DataFrame llamado data con las columnas lwage, exp4 y sex</span>

<span class="c"># Creamos un DataFrame separado para hombres y mujeres</span>
<span class="n">data_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>


<span class="c"># Calculamos las medias de lwage para cada valor único de exp4 para hombres</span>
<span class="n">mean_lwage_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_male</span><span class="p">,</span><span class="w"> </span><span class="ss">:exp4</span><span class="p">),</span><span class="w"> </span><span class="ss">:lwage</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">:mean_lwage</span><span class="p">)</span>

<span class="c"># Ordenar el DataFrame por exp4</span>
<span class="n">sort!</span><span class="p">(</span><span class="n">mean_lwage_male</span><span class="p">,</span><span class="w"> </span><span class="ss">:exp4</span><span class="p">)</span>

<span class="c"># Crear el gráfico para hombres</span>
<span class="n">plot</span><span class="p">(</span><span class="n">mean_lwage_male</span><span class="o">.</span><span class="n">exp4</span><span class="p">,</span><span class="w"> </span><span class="n">mean_lwage_male</span><span class="o">.</span><span class="n">mean_lwage</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:blue</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Mean lwage (Male)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;Experiencia (exp4)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;Media de lwage (lwage)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Media de lwage por exp4 (Hombres)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">mean_lwage_male</span><span class="o">.</span><span class="n">exp4</span><span class="p">,</span><span class="w"> </span><span class="n">mean_lwage_male</span><span class="o">.</span><span class="n">mean_lwage</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:blue</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">linestyle</span><span class="o">=</span><span class="ss">:solid</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Loess&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>
<span class="k">using</span><span class="w"> </span><span class="n">Loess</span>

<span class="c"># Supongamos que tienes un DataFrame llamado data con las columnas lwage, exp4 y sex</span>

<span class="c"># Creamos un DataFrame separado solo para varones</span>
<span class="n">data_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>

<span class="c"># Extraemos las variables independientes y dependientes para el modelo LOESS</span>
<span class="n">exp4_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_male</span><span class="o">.</span><span class="n">exp4</span>
<span class="n">lwage_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_male</span><span class="o">.</span><span class="n">lwage</span>

<span class="c"># Ajustamos un modelo LOESS para varones con un span de ** para menos suavizamiento</span>
<span class="n">loess_model_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loess</span><span class="p">(</span><span class="n">exp4_male</span><span class="p">,</span><span class="w"> </span><span class="n">lwage_male</span><span class="p">,</span><span class="w"> </span><span class="n">span</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>

<span class="c"># Generamos predicciones para el modelo LOESS</span>
<span class="n">exp4_range_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">exp4_male</span><span class="p">),</span><span class="w"> </span><span class="n">maximum</span><span class="p">(</span><span class="n">exp4_male</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">lwage_pred_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">loess_model_male</span><span class="p">,</span><span class="w"> </span><span class="n">exp4_range_male</span><span class="p">)</span>

<span class="c"># Creamos el gráfico para varones con la línea suavizada</span>
<span class="n">plot</span><span class="p">(</span><span class="n">exp4_range_male</span><span class="p">,</span><span class="w"> </span><span class="n">lwage_pred_male</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:red</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Smoothed lwage (Male)&quot;</span><span class="p">)</span>
<span class="n">xlabel!</span><span class="p">(</span><span class="s">&quot;Experiencia (exp4)&quot;</span><span class="p">)</span>
<span class="n">ylabel!</span><span class="p">(</span><span class="s">&quot;lwage&quot;</span><span class="p">)</span>
<span class="n">title!</span><span class="p">(</span><span class="s">&quot;Línea suavizada de lwage por exp4 (Varones)&quot;</span><span class="p">)</span>
<span class="n">xlims!</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w">  </span><span class="c"># Limitar el eje x de 0 a 40</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">data_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="c"># Calculamos las medias de lwage para cada valor único de exp4 para mujeres</span>
<span class="n">mean_lwage_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_female</span><span class="p">,</span><span class="w"> </span><span class="ss">:exp4</span><span class="p">),</span><span class="w"> </span><span class="ss">:lwage</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">:mean_lwage</span><span class="p">)</span>

<span class="c"># Ordenar el DataFrame por exp4</span>
<span class="n">sort!</span><span class="p">(</span><span class="n">mean_lwage_female</span><span class="p">,</span><span class="w"> </span><span class="ss">:exp4</span><span class="p">)</span>

<span class="c"># Crear el gráfico para mujeres</span>
<span class="n">plot</span><span class="p">(</span><span class="n">mean_lwage_female</span><span class="o">.</span><span class="n">exp4</span><span class="p">,</span><span class="w"> </span><span class="n">mean_lwage_female</span><span class="o">.</span><span class="n">mean_lwage</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:red</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Mean lwage (Female)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;Experiencia (exp4)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;Media de lwage (lwage)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Media de lwage por exp4 (Mujeres)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">mean_lwage_female</span><span class="o">.</span><span class="n">exp4</span><span class="p">,</span><span class="w"> </span><span class="n">mean_lwage_female</span><span class="o">.</span><span class="n">mean_lwage</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:red</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">linestyle</span><span class="o">=</span><span class="ss">:solid</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>
<span class="k">using</span><span class="w"> </span><span class="n">Loess</span>

<span class="c"># Supongamos que tienes un DataFrame llamado data con las columnas lwage, exp4 y sex</span>

<span class="c"># Creamos un DataFrame separado solo para mujeres</span>
<span class="n">data_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>

<span class="c"># Extraemos las variables independientes y dependientes para el modelo LOESS</span>
<span class="n">exp4_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_female</span><span class="o">.</span><span class="n">exp4</span>
<span class="n">lwage_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_female</span><span class="o">.</span><span class="n">lwage</span>

<span class="c"># Ajustamos un modelo LOESS para mujeres con un span de 0.95 para menos suavizamiento</span>
<span class="n">loess_model_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loess</span><span class="p">(</span><span class="n">exp4_female</span><span class="p">,</span><span class="w"> </span><span class="n">lwage_female</span><span class="p">,</span><span class="w"> </span><span class="n">span</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>

<span class="c"># Generamos predicciones para el modelo LOESS</span>
<span class="n">exp4_range_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">exp4_female</span><span class="p">),</span><span class="w"> </span><span class="n">maximum</span><span class="p">(</span><span class="n">exp4_female</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">lwage_pred_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">loess_model_female</span><span class="p">,</span><span class="w"> </span><span class="n">exp4_range_female</span><span class="p">)</span>

<span class="c"># Creamos el gráfico para mujeres con la línea suavizada</span>
<span class="n">plot</span><span class="p">(</span><span class="n">exp4_range_female</span><span class="p">,</span><span class="w"> </span><span class="n">lwage_pred_female</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:red</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Smoothed lwage (Female)&quot;</span><span class="p">)</span>
<span class="n">xlabel!</span><span class="p">(</span><span class="s">&quot;Experiencia (exp4)&quot;</span><span class="p">)</span>
<span class="n">ylabel!</span><span class="p">(</span><span class="s">&quot;lwage&quot;</span><span class="p">)</span>
<span class="n">title!</span><span class="p">(</span><span class="s">&quot;Línea suavizada de lwage por exp4 (Mujeres)&quot;</span><span class="p">)</span>
<span class="n">xlims!</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w">  </span><span class="c"># Limitar el eje x de 0 a 40</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">DataFrames</span>
<span class="k">using</span><span class="w"> </span><span class="n">Plots</span>
<span class="k">using</span><span class="w"> </span><span class="n">Loess</span>

<span class="c"># Supongamos que tienes un DataFrame llamado data con las columnas lwage, exp4 y sex</span>

<span class="c"># Creamos un DataFrame separado solo para mujeres</span>
<span class="n">data_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>

<span class="c"># Calculamos las medias de lwage para cada valor único de exp4 para mujeres</span>
<span class="n">mean_lwage_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_female</span><span class="p">,</span><span class="w"> </span><span class="ss">:exp4</span><span class="p">),</span><span class="w"> </span><span class="ss">:lwage</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">:mean_lwage</span><span class="p">)</span>

<span class="c"># Ordenar el DataFrame por exp4</span>
<span class="n">sort!</span><span class="p">(</span><span class="n">mean_lwage_female</span><span class="p">,</span><span class="w"> </span><span class="ss">:exp4</span><span class="p">)</span>

<span class="c"># Extraemos las variables independientes y dependientes para el modelo LOESS</span>
<span class="n">exp4_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_female</span><span class="o">.</span><span class="n">exp4</span>
<span class="n">lwage_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_female</span><span class="o">.</span><span class="n">lwage</span>

<span class="c"># Ajustamos un modelo LOESS para mujeres con un span de 0.95 para menos suavizamiento</span>
<span class="n">loess_model_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loess</span><span class="p">(</span><span class="n">exp4_female</span><span class="p">,</span><span class="w"> </span><span class="n">lwage_female</span><span class="p">,</span><span class="w"> </span><span class="n">span</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>

<span class="c"># Generamos predicciones para el modelo LOESS</span>
<span class="n">exp4_range_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">exp4_female</span><span class="p">),</span><span class="w"> </span><span class="n">maximum</span><span class="p">(</span><span class="n">exp4_female</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">lwage_pred_female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">loess_model_female</span><span class="p">,</span><span class="w"> </span><span class="n">exp4_range_female</span><span class="p">)</span>

<span class="c"># Creamos el gráfico para mujeres con la línea suavizada y los puntos unidos</span>
<span class="n">plot</span><span class="p">(</span><span class="n">exp4_range_female</span><span class="p">,</span><span class="w"> </span><span class="n">lwage_pred_female</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:red</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Smoothed lwage (Female)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">scatter!</span><span class="p">(</span><span class="n">mean_lwage_female</span><span class="o">.</span><span class="n">exp4</span><span class="p">,</span><span class="w"> </span><span class="n">mean_lwage_female</span><span class="o">.</span><span class="n">mean_lwage</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:red</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">seriestype</span><span class="o">=</span><span class="ss">:line</span><span class="p">)</span>
<span class="n">xlabel!</span><span class="p">(</span><span class="s">&quot;Experiencia (exp4)&quot;</span><span class="p">)</span>
<span class="n">ylabel!</span><span class="p">(</span><span class="s">&quot;lwage&quot;</span><span class="p">)</span>
<span class="n">title!</span><span class="p">(</span><span class="s">&quot;Media de lwage y línea suavizada por exp4 (Mujeres)&quot;</span><span class="p">)</span>
<span class="n">xlims!</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w">  </span><span class="c"># Limitar el eje x de 0 a 40</span>
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.10"
        },
        kernelOptions: {
            name: "julia-1.10",
            path: "./labs\lab_1"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.10'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="group3_lab1_r.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab 1 - R Code</p>
      </div>
    </a>
    <a class="right-next"
       href="../lab_2_md.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Multicollinearity, Precision Adjustment, and DAGs for Good and Bad controls</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Lab 1 - Julia Code</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#math-demonstrations"><strong>Math Demonstrations</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prove-the-frisch-waugh-lovell-theorem">1. Prove the Frisch-Waugh-Lovell theorem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#show-that-the-conditional-expectation-function-minimizes-expected-squared-error">2. Show that the Conditional Expectation Function minimizes expected squared error</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#replication-1-code"><strong>Replication 1 - Code</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-analysis">Data Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ols-regression-with-controls">Ols regression with controls</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partialling-out-using-ols">Partialling-Out using ols</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summarize-the-results">Summarize the results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-flexible-model">“Extra” flexible model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-validation-in-lasso-regression-manual-implementation-task"><strong>Cross-Validation in Lasso Regression - Manual Implementation Task</strong></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#replication">Replication</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#women-and-male-graph-quartic">Women and male graph (quartic)</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Matias Villalba
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>